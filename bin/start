#!/bin/bash

if [ "$NODE_ENV" = 'production' ]; then
  # build server & client with gulp
  echo -n 'Building app @ '
  date
  node --harmony `which gulp` build:server build:client

  # run using pm2!
  echo -n 'Booting new app @ '
  date
  pm2 start ecosystem.json

else
  pid='app.pid'
  # log pid if detached & defer to gulp
  node --harmony `which gulp`
  echo $! > "$pid"
fi
