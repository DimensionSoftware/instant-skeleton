<!DOCTYPE html><html lang="en"><head><title>node_modules/LiveScript/lib/lexer</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="node_modules/LiveScript/lib/lexer"><meta name="groc-project-path" content="node_modules/LiveScript/lib/lexer.js"><meta name="groc-github-url" content="https://github.com/DimensionSoftware/instant-skeleton"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/DimensionSoftware/instant-skeleton/blob/master/node_modules/LiveScript/lib/lexer.js">node_modules/LiveScript/lib/lexer.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Generated by LiveScript 1.3.0</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> string, TABS, unlines, enlines, enslash, reslash, camelize, character, KEYWORDS_SHARED, KEYWORDS_UNUSED, JS_KEYWORDS, LS_KEYWORDS, ID, SYMBOL, SPACE, MULTIDENT, SIMPLESTR, JSTOKEN, BSTOKEN, NUMBER, NUMBER_OMIT, REGEX, HEREGEX_OMIT, LASTDENT, INLINEDENT, NONASCII, OPENERS, CLOSERS, INVERSES, i, o, c, CHAIN, ARG, BLOCK_USERS, slice$ = [].slice;
exports.lex = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, options)</span>{</span>
  <span class="hljs-keyword">return</span> clone$(exports).tokenize(code || <span class="hljs-string">''</span>, options || {});
};
exports.rewrite = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">var</span> ref$;
  it || (it = <span class="hljs-keyword">this</span>.tokens);
  firstPass(it);
  addImplicitIndentation(it);
  rewriteBlockless(it);
  addImplicitParentheses(it);
  addImplicitBraces(it);
  expandLiterals(it);
  <span class="hljs-keyword">if</span> (((ref$ = it[<span class="hljs-number">0</span>]) != <span class="hljs-literal">null</span> ? ref$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'NEWLINE'</span>) {
    it.shift();
  }
  <span class="hljs-keyword">return</span> it;
};
exports.tokenize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, o)</span>{</span>
  <span class="hljs-keyword">var</span> i, c, that;
  <span class="hljs-keyword">this</span>.inter || (code = code.replace(<span class="hljs-regexp">/[\r\u2028\u2029\uFEFF]/g</span>, <span class="hljs-string">''</span>));
  code = <span class="hljs-string">'\n'</span> + code;
  <span class="hljs-keyword">this</span>.tokens = [<span class="hljs-keyword">this</span>.last = [<span class="hljs-string">'NEWLINE'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-number">0</span>]];
  <span class="hljs-keyword">this</span>.line = ~-o.line;
  <span class="hljs-keyword">this</span>.dents = [];
  <span class="hljs-keyword">this</span>.closes = [];
  <span class="hljs-keyword">this</span>.parens = [];
  <span class="hljs-keyword">this</span>.flags = [];
  i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (c = code.charAt(i)) {
    <span class="hljs-keyword">switch</span> (c) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">' '</span>:
      i += <span class="hljs-keyword">this</span>.doSpace(code, i);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'\n'</span>:
      i += <span class="hljs-keyword">this</span>.doLine(code, i);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'\\'</span>:
      i += <span class="hljs-keyword">this</span>.doBackslash(code, i);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'\''</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'"'</span>:
      i += <span class="hljs-keyword">this</span>.doString(code, i, c);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"0"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"1"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"2"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"3"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"4"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"5"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"6"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"7"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"8"</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">"9"</span>:
      i += <span class="hljs-keyword">this</span>.doNumber(code, i);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'/'</span>:
      <span class="hljs-keyword">switch</span> (code.charAt(i + <span class="hljs-number">1</span>)) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'*'</span>:
        i += <span class="hljs-keyword">this</span>.doComment(code, i);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'/'</span>:
        i += <span class="hljs-keyword">this</span>.doHeregex(code, i);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">default</span>:
        i += <span class="hljs-keyword">this</span>.doRegex(code, i) || <span class="hljs-keyword">this</span>.doLiteral(code, i);
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'`'</span>:
      <span class="hljs-keyword">if</span> (<span class="hljs-string">'`'</span> === code.charAt(i + <span class="hljs-number">1</span>)) {
        i += <span class="hljs-keyword">this</span>.doJS(code, i);
      } <span class="hljs-keyword">else</span> {
        i += <span class="hljs-keyword">this</span>.doLiteral(code, i);
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      i += <span class="hljs-keyword">this</span>.doID(code, i) || <span class="hljs-keyword">this</span>.doLiteral(code, i) || <span class="hljs-keyword">this</span>.doSpace(code, i);
    }
  }
  <span class="hljs-keyword">this</span>.dedent(<span class="hljs-keyword">this</span>.dent);
  <span class="hljs-keyword">if</span> (that = <span class="hljs-keyword">this</span>.closes.pop()) {
    <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"missing `"</span> + that + <span class="hljs-string">"`"</span>);
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.inter) {
    <span class="hljs-keyword">this</span>.rest == <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">'unterminated interpolation'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.last.spaced = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.newline();
  }
  o.raw || <span class="hljs-keyword">this</span>.rewrite();
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tokens;
};
exports.dent = <span class="hljs-number">0</span>;
exports.identifiers = {};
exports.hasOwn = <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty;
exports.checkConsistency = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(camel, id)</span>{</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hasOwn.call(<span class="hljs-keyword">this</span>.identifiers, camel) &amp;&amp; <span class="hljs-keyword">this</span>.identifiers[camel] !== id) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">ReferenceError</span>(<span class="hljs-string">"Inconsistent use of "</span> + camel + <span class="hljs-string">" as "</span> + id + <span class="hljs-string">" on line "</span> + (-~<span class="hljs-keyword">this</span>.line));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.identifiers[camel] = id;
  }
};
exports.doID = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, index)</span>{</span>
  <span class="hljs-keyword">var</span> regexMatch, input, id, e, last, ref$, tag, ref1$, that;
  input = (regexMatch = (ID.lastIndex = index, ID).exec(code))[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> (!input) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
  id = camelize(regexMatch[<span class="hljs-number">1</span>]);
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/-/</span>.test(regexMatch[<span class="hljs-number">1</span>])) {
    <span class="hljs-keyword">this</span>.checkConsistency(id, regexMatch[<span class="hljs-number">1</span>]);
  }
  <span class="hljs-keyword">if</span> (NONASCII.test(id)) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-built_in">Function</span>(<span class="hljs-string">"var "</span> + id);
    } <span class="hljs-keyword">catch</span> (e$) {
      e = e$;
      <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"invalid identifier \""</span> + id + <span class="hljs-string">"\""</span>);
    }
  }
  last = <span class="hljs-keyword">this</span>.last;
  <span class="hljs-keyword">if</span> (regexMatch[<span class="hljs-number">2</span>] || last[<span class="hljs-number">0</span>] === <span class="hljs-string">'DOT'</span> || <span class="hljs-keyword">this</span>.adi()) {
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'ID'</span>, <span class="hljs-keyword">in</span>$(id, JS_KEYWORDS) ? (ref$ = <span class="hljs-built_in">Object</span>(id), ref$.reserved = <span class="hljs-literal">true</span>, ref$) : id);
    <span class="hljs-keyword">if</span> (regexMatch[<span class="hljs-number">2</span>]) {
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">':'</span>, <span class="hljs-string">':'</span>);
    }
    <span class="hljs-keyword">return</span> input.length;
  }
  <span class="hljs-keyword">switch</span> (id) {
  <span class="hljs-keyword">case</span> <span class="hljs-string">'true'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'false'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'on'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'off'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'yes'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'no'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'null'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'void'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'arguments'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'debugger'</span>:
    tag = <span class="hljs-string">'LITERAL'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'new'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'do'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'typeof'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'delete'</span>:
    tag = <span class="hljs-string">'UNARY'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'yield'</span>:
    tag = <span class="hljs-string">'YIELD'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'return'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'throw'</span>:
    tag = <span class="hljs-string">'HURL'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'break'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'continue'</span>:
    tag = <span class="hljs-string">'JUMP'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'this'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'eval'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'super'</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, id, <span class="hljs-literal">true</span>).length;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'for'</span>:
    id = [];
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'to'</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'then'</span>:
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'to'</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'catch'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'function'</span>:
    id = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'in'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'of'</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.fget(<span class="hljs-string">'for'</span>)) {
      <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">false</span>);
      <span class="hljs-keyword">if</span> (id === <span class="hljs-string">'in'</span>) {
        <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'by'</span>, <span class="hljs-literal">true</span>);
        id = <span class="hljs-string">''</span>;
        <span class="hljs-keyword">if</span> (last[<span class="hljs-number">0</span>] === <span class="hljs-string">'ID'</span> &amp;&amp; ((ref$ = (ref1$ = <span class="hljs-keyword">this</span>.tokens)[ref1$.length - <span class="hljs-number">2</span>][<span class="hljs-number">0</span>]) === <span class="hljs-string">','</span> || ref$ === <span class="hljs-string">']'</span> || ref$ === <span class="hljs-string">'}'</span>)) {
          id = <span class="hljs-keyword">this</span>.tokens.pop()[<span class="hljs-number">1</span>];
          <span class="hljs-keyword">if</span> ((ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">','</span>) {
            <span class="hljs-keyword">this</span>.tokens.pop();
          }
        }
      }
      <span class="hljs-keyword">break</span>;
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">case</span> <span class="hljs-string">'instanceof'</span>:
    <span class="hljs-keyword">if</span> (last[<span class="hljs-number">1</span>] === <span class="hljs-string">'!'</span>) {
      id = <span class="hljs-keyword">this</span>.tokens.pop()[<span class="hljs-number">1</span>] + id;
    }
    tag = (ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span> ? <span class="hljs-string">'BIOPR'</span> : <span class="hljs-string">'RELATION'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'not'</span>:
    <span class="hljs-keyword">if</span> (last.alias &amp;&amp; last[<span class="hljs-number">1</span>] === <span class="hljs-string">'==='</span>) {
      <span class="hljs-keyword">return</span> last[<span class="hljs-number">1</span>] = <span class="hljs-string">'!=='</span>, <span class="hljs-number">3</span>;
    }
    tag = <span class="hljs-string">'UNARY'</span>;
    id = <span class="hljs-string">'!'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'and'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'or'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'xor'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'is'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'isnt'</span>:
    <span class="hljs-keyword">this</span>.unline();
    tag = id === <span class="hljs-string">'is'</span> || id === <span class="hljs-string">'isnt'</span> ? <span class="hljs-string">'COMPARE'</span> : <span class="hljs-string">'LOGIC'</span>;
    <span class="hljs-keyword">if</span> (last[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span>) {
      tag = <span class="hljs-string">'BIOP'</span>;
    }
    <span class="hljs-keyword">this</span>.token(tag, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-keyword">switch</span> (id) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'is'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'==='</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'isnt'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'!=='</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'or'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'||'</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'and'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'&amp;&amp;'</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'xor'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'xor'</span>;
      }
    }()));
    <span class="hljs-keyword">this</span>.last.alias = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> id.length;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'unless'</span>:
    tag = <span class="hljs-string">'IF'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'until'</span>:
    tag = <span class="hljs-string">'WHILE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'import'</span>:
    <span class="hljs-keyword">if</span> (last[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span>) {
      id = <span class="hljs-string">'&lt;&lt;&lt;'</span>;
      tag = <span class="hljs-string">'BIOP'</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (able(<span class="hljs-keyword">this</span>.tokens)) {
        id = <span class="hljs-string">'&lt;&lt;&lt;'</span>;
      } <span class="hljs-keyword">else</span> {
        tag = <span class="hljs-string">'DECL'</span>;
      }
    }
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'export'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'const'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'var'</span>:
    tag = <span class="hljs-string">'DECL'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'with'</span>:
    tag = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-literal">false</span>) {
      <span class="hljs-keyword">case</span> !able(<span class="hljs-keyword">this</span>.tokens):
        <span class="hljs-keyword">return</span> <span class="hljs-string">'CLONEPORT'</span>;
      <span class="hljs-keyword">case</span> last[<span class="hljs-number">0</span>] !== <span class="hljs-string">'('</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'BIOP'</span>;
      <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'WITH'</span>;
      }
    }.call(<span class="hljs-keyword">this</span>));
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'when'</span>:
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">false</span>);
    tag = <span class="hljs-string">'CASE'</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">case</span> <span class="hljs-string">'case'</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.doCase()) {
      <span class="hljs-keyword">return</span> input.length;
    }
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'match'</span>:
    tag = <span class="hljs-string">'SWITCH'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'loop'</span>:
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'WHILE'</span>, id);
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'true'</span>);
    <span class="hljs-keyword">return</span> input.length;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'let'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'own'</span>:
    <span class="hljs-keyword">if</span> (last[<span class="hljs-number">0</span>] === <span class="hljs-string">'FOR'</span> &amp;&amp; !<span class="hljs-keyword">in</span>$(id, last[<span class="hljs-number">1</span>])) {
      last[<span class="hljs-number">1</span>].push(id);
      <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">in</span>$(id, KEYWORDS_SHARED)) {
      <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">in</span>$(id, KEYWORDS_UNUSED)) {
      <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"reserved word \""</span> + id + <span class="hljs-string">"\""</span>);
    }
    <span class="hljs-keyword">if</span> (!last[<span class="hljs-number">1</span>] &amp;&amp; ((ref$ = last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'FUNCTION'</span> || ref$ === <span class="hljs-string">'GENERATOR'</span> || ref$ === <span class="hljs-string">'LABEL'</span>)) {
      last[<span class="hljs-number">1</span>] = id;
      last.spaced = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> input.length;
    }
    tag = <span class="hljs-string">'ID'</span>;
    <span class="hljs-keyword">switch</span> (id) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'otherwise'</span>:
      <span class="hljs-keyword">if</span> ((ref$ = last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'CASE'</span> || ref$ === <span class="hljs-string">'|'</span>) {
        last[<span class="hljs-number">0</span>] = <span class="hljs-string">'DEFAULT'</span>;
        <span class="hljs-keyword">return</span> id.length;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'all'</span>:
      <span class="hljs-keyword">if</span> (that = last[<span class="hljs-number">1</span>] === <span class="hljs-string">'&lt;&lt;&lt;'</span> &amp;&amp; <span class="hljs-string">'&lt;'</span> || last[<span class="hljs-number">1</span>] === <span class="hljs-string">'import'</span> &amp;&amp; <span class="hljs-string">'All'</span>) {
        last[<span class="hljs-number">1</span>] += that;
        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'from'</span>:
      <span class="hljs-keyword">if</span> (last[<span class="hljs-number">1</span>] === <span class="hljs-string">'yield'</span>) {
        last[<span class="hljs-number">1</span>] += <span class="hljs-string">'from'</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;
      }
      <span class="hljs-keyword">this</span>.forange() &amp;&amp; (tag = <span class="hljs-string">'FROM'</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'to'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'til'</span>:
      <span class="hljs-keyword">this</span>.forange() &amp;&amp; <span class="hljs-keyword">this</span>.tokens.push([<span class="hljs-string">'FROM'</span>, <span class="hljs-string">''</span>, <span class="hljs-keyword">this</span>.line], [<span class="hljs-string">'STRNUM'</span>, <span class="hljs-string">'0'</span>, <span class="hljs-keyword">this</span>.line]);
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.fget(<span class="hljs-string">'from'</span>)) {
        <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'from'</span>, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'by'</span>, <span class="hljs-literal">true</span>);
        tag = <span class="hljs-string">'TO'</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!last.callable &amp;&amp; last[<span class="hljs-number">0</span>] === <span class="hljs-string">'STRNUM'</span> &amp;&amp; (ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'['</span>) {
        last[<span class="hljs-number">0</span>] = <span class="hljs-string">'RANGE'</span>;
        last.op = id;
        <span class="hljs-keyword">return</span> id.length;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">in</span>$(<span class="hljs-string">']'</span>, <span class="hljs-keyword">this</span>.closes)) {
        <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'TO'</span>, id);
        <span class="hljs-keyword">return</span> id.length;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'by'</span>:
      <span class="hljs-keyword">if</span> (last[<span class="hljs-number">0</span>] === <span class="hljs-string">'STRNUM'</span> &amp;&amp; (ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'RANGE'</span> &amp;&amp; (ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">3</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'['</span>) {
        tag = <span class="hljs-string">'RANGE_BY'</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">in</span>$(<span class="hljs-string">']'</span>, <span class="hljs-keyword">this</span>.closes)) {
        tag = <span class="hljs-string">'BY'</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.fget(<span class="hljs-string">'by'</span>)) {
        tag = <span class="hljs-string">'BY'</span>;
        <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'by'</span>, <span class="hljs-literal">false</span>);
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'ever'</span>:
      <span class="hljs-keyword">if</span> (last[<span class="hljs-number">0</span>] === <span class="hljs-string">'FOR'</span>) {
        <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">false</span>);
        last[<span class="hljs-number">0</span>] = <span class="hljs-string">'WHILE'</span>;
        tag = <span class="hljs-string">'LITERAL'</span>;
        id = <span class="hljs-string">'true'</span>;
      }
    }
  }
  tag || (tag = regexMatch[<span class="hljs-number">1</span>].toUpperCase());
  <span class="hljs-keyword">if</span> ((tag === <span class="hljs-string">'COMPARE'</span> || tag === <span class="hljs-string">'LOGIC'</span> || tag === <span class="hljs-string">'RELATION'</span>) &amp;&amp; last[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span>) {
    tag = tag === <span class="hljs-string">'RELATION'</span> ? <span class="hljs-string">'BIOPR'</span> : <span class="hljs-string">'BIOP'</span>;
  }
  <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'THEN'</span> || tag === <span class="hljs-string">'IF'</span> || tag === <span class="hljs-string">'WHILE'</span>) {
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'by'</span>, <span class="hljs-literal">false</span>);
  }
  <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'RELATION'</span> || tag === <span class="hljs-string">'THEN'</span> || tag === <span class="hljs-string">'ELSE'</span> || tag === <span class="hljs-string">'CASE'</span> || tag === <span class="hljs-string">'DEFAULT'</span> || tag === <span class="hljs-string">'CATCH'</span> || tag === <span class="hljs-string">'FINALLY'</span> || tag === <span class="hljs-string">'IN'</span> || tag === <span class="hljs-string">'OF'</span> || tag === <span class="hljs-string">'FROM'</span> || tag === <span class="hljs-string">'TO'</span> || tag === <span class="hljs-string">'BY'</span> || tag === <span class="hljs-string">'EXTENDS'</span> || tag === <span class="hljs-string">'IMPLEMENTS'</span> || tag === <span class="hljs-string">'WHERE'</span>) {
    <span class="hljs-keyword">this</span>.unline();
  }
  <span class="hljs-keyword">this</span>.token(tag, id);
  <span class="hljs-keyword">return</span> input.length;
};
exports.doNumber = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, lastIndex)</span>{</span>
  <span class="hljs-keyword">var</span> input, regexMatch, last, radix, num, rnum, bound, ref$;
  NUMBER.lastIndex = lastIndex;
  <span class="hljs-keyword">if</span> (!(input = (regexMatch = NUMBER.exec(code))[<span class="hljs-number">0</span>])) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
  last = <span class="hljs-keyword">this</span>.last;
  <span class="hljs-keyword">if</span> (regexMatch[<span class="hljs-number">5</span>] &amp;&amp; (last[<span class="hljs-number">0</span>] === <span class="hljs-string">'DOT'</span> || <span class="hljs-keyword">this</span>.adi())) {
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'STRNUM'</span>, regexMatch[<span class="hljs-number">4</span>].replace(NUMBER_OMIT, <span class="hljs-string">''</span>));
    <span class="hljs-keyword">return</span> regexMatch[<span class="hljs-number">4</span>].length;
  }
  <span class="hljs-keyword">if</span> (radix = regexMatch[<span class="hljs-number">1</span>]) {
    num = <span class="hljs-built_in">parseInt</span>(rnum = regexMatch[<span class="hljs-number">2</span>].replace(NUMBER_OMIT, <span class="hljs-string">''</span>), radix);
    bound = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (radix &gt; <span class="hljs-number">36</span> || radix &lt; <span class="hljs-number">2</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[0-9]/</span>.exec(rnum)) {
        <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"invalid number base "</span> + radix + <span class="hljs-string">" (with number "</span> + rnum + <span class="hljs-string">"),base must be from 2 to 36"</span>);
      } <span class="hljs-keyword">else</span> {
        bound = <span class="hljs-literal">true</span>;
      }
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(num) || num === <span class="hljs-built_in">parseInt</span>(rnum.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>), radix)) {
      <span class="hljs-keyword">this</span>.strnum(regexMatch[<span class="hljs-number">1</span>]);
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'DOT'</span>, <span class="hljs-string">'.~'</span>);
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'ID'</span>, regexMatch[<span class="hljs-number">2</span>]);
      <span class="hljs-keyword">return</span> input.length;
    }
    num += <span class="hljs-string">''</span>;
  } <span class="hljs-keyword">else</span> {
    num = (regexMatch[<span class="hljs-number">3</span>] || input).replace(NUMBER_OMIT, <span class="hljs-string">''</span>);
    <span class="hljs-keyword">if</span> (regexMatch[<span class="hljs-number">3</span>] &amp;&amp; num.charAt() === <span class="hljs-string">'0'</span> &amp;&amp; ((ref$ = num.charAt(<span class="hljs-number">1</span>)) !== <span class="hljs-string">''</span> &amp;&amp; ref$ !== <span class="hljs-string">'.'</span>)) {
      <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"deprecated octal literal "</span> + regexMatch[<span class="hljs-number">4</span>]);
    }
  }
  <span class="hljs-keyword">if</span> (!last.spaced &amp;&amp; last[<span class="hljs-number">0</span>] === <span class="hljs-string">'+-'</span>) {
    last[<span class="hljs-number">0</span>] = <span class="hljs-string">'STRNUM'</span>;
    last[<span class="hljs-number">1</span>] += num;
    <span class="hljs-keyword">return</span> input.length;
  }
  <span class="hljs-keyword">this</span>.strnum(num);
  <span class="hljs-keyword">return</span> input.length;
};
exports.doString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, index, q)</span>{</span>
  <span class="hljs-keyword">var</span> parts, str;
  <span class="hljs-keyword">if</span> (q === code.charAt(index + <span class="hljs-number">1</span>)) {
    <span class="hljs-keyword">return</span> q === code.charAt(index + <span class="hljs-number">2</span>)
      ? <span class="hljs-keyword">this</span>.doHeredoc(code, index, q)
      : (<span class="hljs-keyword">this</span>.strnum(q + q), <span class="hljs-number">2</span>);
  }
  <span class="hljs-keyword">if</span> (q === <span class="hljs-string">'"'</span>) {
    parts = <span class="hljs-keyword">this</span>.interpolate(code, index, q);
    <span class="hljs-keyword">this</span>.addInterpolated(parts, unlines);
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> + parts.size;
  }
  str = (SIMPLESTR.lastIndex = index, SIMPLESTR).exec(code)[<span class="hljs-number">0</span>] || <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">'unterminated string'</span>);
  <span class="hljs-keyword">this</span>.strnum(unlines(<span class="hljs-keyword">this</span>.string(q, str.slice(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>))));
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countLines(str).length;
};
exports.doHeredoc = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, index, q)</span>{</span>
  <span class="hljs-keyword">var</span> end, raw, doc, parts, tabs, i$, len$, i, t;
  <span class="hljs-keyword">if</span> (q === <span class="hljs-string">'\''</span>) {
    ~(end = code.indexOf(q + q + q, index + <span class="hljs-number">3</span>)) || <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">'unterminated heredoc'</span>);
    raw = code.slice(index + <span class="hljs-number">3</span>, end);
    doc = raw.replace(LASTDENT, <span class="hljs-string">''</span>);
    <span class="hljs-keyword">this</span>.strnum(enlines(<span class="hljs-keyword">this</span>.string(q, lchomp(detab(doc, heretabs(doc))))));
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countLines(raw).length + <span class="hljs-number">6</span>;
  }
  parts = <span class="hljs-keyword">this</span>.interpolate(code, index, q + q + q);
  tabs = heretabs(code.slice(index + <span class="hljs-number">3</span>, index + parts.size).replace(LASTDENT, <span class="hljs-string">''</span>));
  <span class="hljs-keyword">for</span> (i$ = <span class="hljs-number">0</span>, len$ = parts.length; i$ &lt; len$; ++i$) {
    i = i$;
    t = parts[i$];
    <span class="hljs-keyword">if</span> (t[<span class="hljs-number">0</span>] === <span class="hljs-string">'S'</span>) {
      <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span> === parts.length) {
        t[<span class="hljs-number">1</span>] = t[<span class="hljs-number">1</span>].replace(LASTDENT, <span class="hljs-string">''</span>);
      }
      t[<span class="hljs-number">1</span>] = detab(t[<span class="hljs-number">1</span>], tabs);
      <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) {
        t[<span class="hljs-number">1</span>] = lchomp(t[<span class="hljs-number">1</span>]);
      }
    }
  }
  <span class="hljs-keyword">this</span>.addInterpolated(parts, enlines);
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span> + parts.size;
};
exports.doComment = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, index)</span>{</span>
  <span class="hljs-keyword">var</span> comment, end, ref$;
  comment = ~(end = code.indexOf(<span class="hljs-string">'*/'</span>, index + <span class="hljs-number">2</span>))
    ? code.slice(index, end + <span class="hljs-number">2</span>)
    : code.slice(index) + <span class="hljs-string">'*/'</span>;
  <span class="hljs-keyword">if</span> ((ref$ = <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'NEWLINE'</span> || ref$ === <span class="hljs-string">'INDENT'</span> || ref$ === <span class="hljs-string">'THEN'</span>) {
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'COMMENT'</span>, detab(comment, <span class="hljs-keyword">this</span>.dent));
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'NEWLINE'</span>, <span class="hljs-string">'\n'</span>);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countLines(comment).length;
};
exports.doJS = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, lastIndex)</span>{</span>
  <span class="hljs-keyword">var</span> js, ref$;
  JSTOKEN.lastIndex = lastIndex;
  js = JSTOKEN.exec(code)[<span class="hljs-number">0</span>] || <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">'unterminated JS literal'</span>);
  <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, (ref$ = <span class="hljs-built_in">Object</span>(detab(js.slice(<span class="hljs-number">2</span>, -<span class="hljs-number">2</span>), <span class="hljs-keyword">this</span>.dent)), ref$.js = <span class="hljs-literal">true</span>, ref$), <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countLines(js).length;
};
exports.doRegex = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, index)</span>{</span>
  <span class="hljs-keyword">var</span> divisible, ref$, input, body, flag;
  <span class="hljs-keyword">if</span> (divisible = able(<span class="hljs-keyword">this</span>.tokens) || <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'CREMENT'</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.last.spaced || ((ref$ = code.charAt(index + <span class="hljs-number">1</span>)) === <span class="hljs-string">' '</span> || ref$ === <span class="hljs-string">'='</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
  }
  ref$ = (REGEX.lastIndex = index, REGEX).exec(code), input = ref$[<span class="hljs-number">0</span>], body = ref$[<span class="hljs-number">1</span>], flag = ref$[<span class="hljs-number">2</span>];
  <span class="hljs-keyword">if</span> (input) {
    <span class="hljs-keyword">this</span>.regex(body, flag);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!divisible &amp;&amp; <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] !== <span class="hljs-string">'('</span>) {
    <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">'unterminated regex'</span>);
  }
  <span class="hljs-keyword">return</span> input.length;
};
exports.doHeregex = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, index)</span>{</span>
  <span class="hljs-keyword">var</span> tokens, last, parts, rest, flag, i$, i, t, dynaflag, len$, val, one;
  tokens = <span class="hljs-keyword">this</span>.tokens, last = <span class="hljs-keyword">this</span>.last;
  parts = <span class="hljs-keyword">this</span>.interpolate(code, index, <span class="hljs-string">'//'</span>);
  rest = code.slice(index + <span class="hljs-number">2</span> + parts.size);
  flag = <span class="hljs-keyword">this</span>.validate(<span class="hljs-regexp">/^(?:[gimy]{1,4}|[?$]?)/</span>.exec(rest)[<span class="hljs-number">0</span>]);
  <span class="hljs-keyword">if</span> (parts[<span class="hljs-number">1</span>]) {
    <span class="hljs-keyword">if</span> (flag === <span class="hljs-string">'$'</span>) {
      <span class="hljs-keyword">this</span>.adi();
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'('</span>, <span class="hljs-string">'"'</span>);
    } <span class="hljs-keyword">else</span> {
      tokens.push([<span class="hljs-string">'ID'</span>, <span class="hljs-string">'RegExp'</span>, last[<span class="hljs-number">2</span>]], [<span class="hljs-string">'CALL('</span>, <span class="hljs-string">''</span>, last[<span class="hljs-number">2</span>]]);
      <span class="hljs-keyword">if</span> (flag === <span class="hljs-string">'?'</span>) {
        <span class="hljs-keyword">for</span> (i$ = parts.length - <span class="hljs-number">1</span>; i$ &gt;= <span class="hljs-number">0</span>; --i$) {
          i = i$;
          t = parts[i$];
          <span class="hljs-keyword">if</span> (t[<span class="hljs-number">0</span>] === <span class="hljs-string">'TOKENS'</span>) {
            dynaflag = parts.splice(i, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];
            <span class="hljs-keyword">break</span>;
          }
        }
      }
    }
    <span class="hljs-keyword">for</span> (i$ = <span class="hljs-number">0</span>, len$ = parts.length; i$ &lt; len$; ++i$) {
      i = i$;
      t = parts[i$];
      <span class="hljs-keyword">if</span> (t[<span class="hljs-number">0</span>] === <span class="hljs-string">'TOKENS'</span>) {
        tokens.push.apply(tokens, t[<span class="hljs-number">1</span>]);
      } <span class="hljs-keyword">else</span> {
        val = t[<span class="hljs-number">1</span>].replace(HEREGEX_OMIT, <span class="hljs-string">''</span>);
        <span class="hljs-keyword">if</span> (one &amp;&amp; !val) {
          <span class="hljs-keyword">continue</span>;
        }
        one = tokens.push((t[<span class="hljs-number">0</span>] = <span class="hljs-string">'STRNUM'</span>, t[<span class="hljs-number">1</span>] = <span class="hljs-keyword">this</span>.string(<span class="hljs-string">'\''</span>, enslash(val)), t));
      }
      tokens.push([<span class="hljs-string">'+-'</span>, <span class="hljs-string">'+'</span>, tokens[tokens.length - <span class="hljs-number">1</span>][<span class="hljs-number">2</span>]]);
    }
    --tokens.length;
    <span class="hljs-keyword">if</span> (dynaflag || flag &gt;= <span class="hljs-string">'g'</span>) {
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">','</span>, <span class="hljs-string">','</span>);
      <span class="hljs-keyword">if</span> (dynaflag) {
        tokens.push.apply(tokens, dynaflag);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'STRNUM'</span>, <span class="hljs-string">"'"</span> + flag + <span class="hljs-string">"'"</span>);
      }
    }
    <span class="hljs-keyword">this</span>.token(flag === <span class="hljs-string">'$'</span> ? <span class="hljs-string">')'</span> : <span class="hljs-string">')CALL'</span>, <span class="hljs-string">''</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.regex(reslash(parts[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>].replace(HEREGEX_OMIT, <span class="hljs-string">''</span>)), flag);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> + parts.size + flag.length;
};
exports.doBackslash = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, lastIndex)</span>{</span>
  <span class="hljs-keyword">var</span> ref$, input, word;
  BSTOKEN.lastIndex = lastIndex;
  ref$ = BSTOKEN.exec(code), input = ref$[<span class="hljs-number">0</span>], word = ref$[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">if</span> (word) {
    <span class="hljs-keyword">this</span>.strnum(<span class="hljs-keyword">this</span>.string(<span class="hljs-string">'\''</span>, word));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.countLines(input);
  }
  <span class="hljs-keyword">return</span> input.length;
};
exports.doLine = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, index)</span>{</span>
  <span class="hljs-keyword">var</span> ref$, input, tabs, length, last, that, delta, tag, val;
  ref$ = (MULTIDENT.lastIndex = index, MULTIDENT).exec(code), input = ref$[<span class="hljs-number">0</span>], tabs = ref$[<span class="hljs-number">1</span>];
  length = <span class="hljs-keyword">this</span>.countLines(input).length;
  last = <span class="hljs-keyword">this</span>.last;
  last.eol = <span class="hljs-literal">true</span>;
  last.spaced = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (index + length &gt;= code.length) {
    <span class="hljs-keyword">return</span> length;
  }
  <span class="hljs-keyword">if</span> (that = tabs &amp;&amp; (<span class="hljs-keyword">this</span>.emender || (<span class="hljs-keyword">this</span>.emender = <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'[^'</span> + tabs.charAt() + <span class="hljs-string">']'</span>))).exec(tabs)) {
    <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"contaminated indent "</span> + <span class="hljs-built_in">escape</span>(that));
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &gt; (delta = tabs.length - <span class="hljs-keyword">this</span>.dent)) {
    <span class="hljs-keyword">this</span>.dedent(-delta);
    <span class="hljs-keyword">this</span>.newline();
  } <span class="hljs-keyword">else</span> {
    tag = last[<span class="hljs-number">0</span>], val = last[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'ASSIGN'</span> &amp;&amp; ((ref$ = val + <span class="hljs-string">''</span>) !== <span class="hljs-string">'='</span> &amp;&amp; ref$ !== <span class="hljs-string">':='</span> &amp;&amp; ref$ !== <span class="hljs-string">'+='</span>) || val === <span class="hljs-string">'++'</span> &amp;&amp; (ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">2</span>].spaced || (tag === <span class="hljs-string">'+-'</span> || tag === <span class="hljs-string">'PIPE'</span> || tag === <span class="hljs-string">'BACKPIPE'</span> || tag === <span class="hljs-string">'DOT'</span> || tag === <span class="hljs-string">'LOGIC'</span> || tag === <span class="hljs-string">'MATH'</span> || tag === <span class="hljs-string">'COMPARE'</span> || tag === <span class="hljs-string">'RELATION'</span> || tag === <span class="hljs-string">'SHIFT'</span> || tag === <span class="hljs-string">'IN'</span> || tag === <span class="hljs-string">'OF'</span> || tag === <span class="hljs-string">'TO'</span> || tag === <span class="hljs-string">'BY'</span> || tag === <span class="hljs-string">'FROM'</span> || tag === <span class="hljs-string">'EXTENDS'</span> || tag === <span class="hljs-string">'IMPLEMENTS'</span>)) {
      <span class="hljs-keyword">return</span> length;
    }
    <span class="hljs-keyword">if</span> (delta) {
      <span class="hljs-keyword">this</span>.indent(delta);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.newline();
    }
  }
  <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">false</span>);
  <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'by'</span>, <span class="hljs-literal">false</span>);
  <span class="hljs-keyword">return</span> length;
};
exports.doSpace = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, lastIndex)</span>{</span>
  <span class="hljs-keyword">var</span> input;
  SPACE.lastIndex = lastIndex;
  <span class="hljs-keyword">if</span> (input = SPACE.exec(code)[<span class="hljs-number">0</span>]) {
    <span class="hljs-keyword">this</span>.last.spaced = <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">return</span> input.length;
};
exports.doCase = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> ref$, ref1$;
  <span class="hljs-keyword">this</span>.seenFor = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (((ref$ = <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'ASSIGN'</span> || ref$ === <span class="hljs-string">'-&gt;'</span> || ref$ === <span class="hljs-string">':'</span>) || (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'INDENT'</span> &amp;&amp; ((ref$ = (ref1$ = <span class="hljs-keyword">this</span>.tokens)[ref1$.length - <span class="hljs-number">2</span>][<span class="hljs-number">0</span>]) === <span class="hljs-string">'ASSIGN'</span> || ref$ === <span class="hljs-string">'-&gt;'</span> || ref$ === <span class="hljs-string">':'</span>))) {
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'SWITCH'</span>, <span class="hljs-string">'switch'</span>);
    <span class="hljs-keyword">this</span>.line++;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'CASE'</span>, <span class="hljs-string">'case'</span>);
  }
};
exports.doLiteral = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, index)</span>{</span>
  <span class="hljs-keyword">var</span> sym, tag, val, ref$, that;
  <span class="hljs-keyword">if</span> (!(sym = (SYMBOL.lastIndex = index, SYMBOL).exec(code)[<span class="hljs-number">0</span>])) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">switch</span> (tag = val = sym) {
  <span class="hljs-keyword">case</span> <span class="hljs-string">'|'</span>:
    tag = <span class="hljs-string">'CASE'</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.doCase()) {
      <span class="hljs-keyword">return</span> sym.length;
    }
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'|&gt;'</span>:
    tag = <span class="hljs-string">'PIPE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'`'</span>:
    tag = <span class="hljs-string">'BACKTICK'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;&lt;'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;&gt;'</span>:
    tag = <span class="hljs-string">'COMPOSE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;|'</span>:
    tag = <span class="hljs-string">'BACKPIPE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'+'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'-'</span>:
    tag = <span class="hljs-string">'+-'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&amp;&amp;'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'||'</span>:
    tag = <span class="hljs-string">'LOGIC'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.&amp;.'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.|.'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.^.'</span>:
    tag = <span class="hljs-string">'BITWISE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^^'</span>:
    tag = <span class="hljs-string">'CLONE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'**'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^'</span>:
    tag = <span class="hljs-string">'POWER'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'?'</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span>) {
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'PARAM('</span>, <span class="hljs-string">'('</span>);
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">')PARAM'</span>, <span class="hljs-string">')'</span>);
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'-&gt;'</span>, <span class="hljs-string">'-&gt;'</span>);
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'ID'</span>, <span class="hljs-string">'it'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last.spaced) {
        tag = <span class="hljs-string">'LOGIC'</span>;
      }
    }
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'/'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'%'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'%%'</span>:
    tag = <span class="hljs-string">'MATH'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'++'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'--'</span>:
    tag = <span class="hljs-string">'CREMENT'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;&lt;&lt;'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;&lt;&lt;&lt;'</span>:
    tag = <span class="hljs-string">'IMPORT'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">';'</span>:
    tag = <span class="hljs-string">'NEWLINE'</span>;
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'by'</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'..'</span>:
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'..'</span>, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.'</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'?'</span>) {
      <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] = <span class="hljs-string">'?'</span>;
    }
    tag = <span class="hljs-string">'DOT'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">','</span>:
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">','</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'['</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'('</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CALL('</span>:
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'void'</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'FOR'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'OWN'</span>:
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'ID'</span>, <span class="hljs-string">''</span>);
    }
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'!='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'~='</span>:
    <span class="hljs-keyword">if</span> (!(able(<span class="hljs-keyword">this</span>.tokens) || ((ref$ = <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'('</span> || ref$ === <span class="hljs-string">'CREMENT'</span>))) {
      <span class="hljs-keyword">this</span>.tokens.push(val === <span class="hljs-string">'!='</span>
        ? [<span class="hljs-string">'UNARY'</span>, <span class="hljs-string">'!'</span>, <span class="hljs-keyword">this</span>.line]
        : [<span class="hljs-string">'UNARY'</span>, <span class="hljs-string">'~'</span>, <span class="hljs-keyword">this</span>.line], [<span class="hljs-string">'ASSIGN'</span>, <span class="hljs-string">'='</span>, <span class="hljs-keyword">this</span>.line]);
      <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">case</span> <span class="hljs-string">'!~='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'=='</span>:
    val = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-keyword">switch</span> (val) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'~='</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'=='</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'!~='</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'!='</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'=='</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'==='</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'!='</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'!=='</span>;
      }
    }());
    tag = <span class="hljs-string">'COMPARE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'==='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'!=='</span>:
    val += <span class="hljs-string">'='</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;=='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;=='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;&gt;='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;&lt;='</span>:
    tag = <span class="hljs-string">'COMPARE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.&lt;&lt;.'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.&gt;&gt;.'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.&gt;&gt;&gt;.'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;?'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;?'</span>:
    tag = <span class="hljs-string">'SHIFT'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'('</span>:
    <span class="hljs-keyword">if</span> (!(((ref$ = <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'FUNCTION'</span> || ref$ === <span class="hljs-string">'GENERATOR'</span> || ref$ === <span class="hljs-string">'LET'</span>) || <span class="hljs-keyword">this</span>.able(<span class="hljs-literal">true</span>) || <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'.@'</span>)) {
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'('</span>, <span class="hljs-string">'('</span>);
      <span class="hljs-keyword">this</span>.closes.push(<span class="hljs-string">')'</span>);
      <span class="hljs-keyword">this</span>.parens.push(<span class="hljs-keyword">this</span>.last);
      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    tag = <span class="hljs-string">'CALL('</span>;
    <span class="hljs-keyword">this</span>.closes.push(<span class="hljs-string">')CALL'</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'['</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'{'</span>:
    <span class="hljs-keyword">this</span>.adi();
    <span class="hljs-keyword">this</span>.closes.push(<span class="hljs-string">']}'</span>.charAt(val === <span class="hljs-string">'{'</span>));
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'}'</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.inter &amp;&amp; val !== (ref$ = <span class="hljs-keyword">this</span>.closes)[ref$.length - <span class="hljs-number">1</span>]) {
      <span class="hljs-keyword">this</span>.rest = code.slice(index + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-number">9e9</span>;
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">case</span> <span class="hljs-string">']'</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">')'</span>:
    <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">')'</span> &amp;&amp; ((ref$ = <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'+-'</span> || ref$ === <span class="hljs-string">'COMPARE'</span> || ref$ === <span class="hljs-string">'LOGIC'</span> || ref$ === <span class="hljs-string">'MATH'</span> || ref$ === <span class="hljs-string">'POWER'</span> || ref$ === <span class="hljs-string">'SHIFT'</span> || ref$ === <span class="hljs-string">'BITWISE'</span> || ref$ === <span class="hljs-string">'CONCAT'</span> || ref$ === <span class="hljs-string">'COMPOSE'</span> || ref$ === <span class="hljs-string">'RELATION'</span> || ref$ === <span class="hljs-string">'PIPE'</span> || ref$ === <span class="hljs-string">'BACKPIPE'</span> || ref$ === <span class="hljs-string">'IMPORT'</span> || ref$ === <span class="hljs-string">'CLONEPORT'</span> || ref$ === <span class="hljs-string">'ASSIGN'</span>)) {
      (ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'RELATION'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'BIOPR'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'PIPE'</span>:
          <span class="hljs-keyword">this</span>.parameters(<span class="hljs-literal">false</span>, -<span class="hljs-number">1</span>);
          <span class="hljs-keyword">return</span> <span class="hljs-string">'BIOPP'</span>;
        <span class="hljs-keyword">default</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'BIOP'</span>;
        }
      }.call(<span class="hljs-keyword">this</span>));
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-string">')'</span> === (tag = val = <span class="hljs-keyword">this</span>.pair(val))) {
      <span class="hljs-keyword">this</span>.lpar = <span class="hljs-keyword">this</span>.parens.pop();
    }
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">':'</span>:
    <span class="hljs-keyword">if</span> (val === <span class="hljs-string">':'</span>) {
      <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'ID'</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">'STRNUM'</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">')'</span>:
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'...'</span>:
        <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] = <span class="hljs-string">'STRNUM'</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">default</span>:
        tag = <span class="hljs-string">'LABEL'</span>;
        val = <span class="hljs-string">''</span>;
      }
      <span class="hljs-keyword">this</span>.token(tag, val);
      <span class="hljs-keyword">return</span> sym.length;
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">case</span> <span class="hljs-string">':='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'+='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'-='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'*='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'/='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'%='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'%%='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;?='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;?='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'**='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.&amp;.='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.|.='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.^.='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.&lt;&lt;.='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.&gt;&gt;.='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'.&gt;&gt;&gt;.='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'++='</span>:
  <span class="hljs-keyword">case</span> <span class="hljs-string">'|&gt;='</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'.'</span> || <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'?'</span> &amp;&amp; <span class="hljs-keyword">this</span>.adi()) {
      <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] += val;
      <span class="hljs-keyword">return</span> val.length;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'LOGIC'</span>) {
      (val = <span class="hljs-built_in">Object</span>(val)).logic = <span class="hljs-keyword">this</span>.tokens.pop()[<span class="hljs-number">1</span>];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((val === <span class="hljs-string">'+='</span> || val === <span class="hljs-string">'-='</span>) &amp;&amp; !able(<span class="hljs-keyword">this</span>.tokens) &amp;&amp; ((ref$ = <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) !== <span class="hljs-string">'+-'</span> &amp;&amp; ref$ !== <span class="hljs-string">'UNARY'</span> &amp;&amp; ref$ !== <span class="hljs-string">'LABEL'</span>)) {
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'UNARY'</span>, val.charAt());
      val = <span class="hljs-string">'='</span>;
    }
    tag = <span class="hljs-string">'ASSIGN'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'::='</span>:
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'DOT'</span>, <span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'ID'</span>, <span class="hljs-string">'prototype'</span>);
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'IMPORT'</span>, <span class="hljs-string">'&lt;&lt;'</span>);
    <span class="hljs-keyword">return</span> sym.length;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'*'</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'FUNCTION'</span>) {
      <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] = <span class="hljs-string">'GENERATOR'</span>;
      <span class="hljs-keyword">return</span> sym.length;
    }
    <span class="hljs-keyword">if</span> (that = ((ref$ = <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'NEWLINE'</span> || ref$ === <span class="hljs-string">'INDENT'</span> || ref$ === <span class="hljs-string">'THEN'</span> || ref$ === <span class="hljs-string">'=&gt;'</span>) &amp;&amp; (INLINEDENT.lastIndex = index + <span class="hljs-number">1</span>, INLINEDENT).exec(code)[<span class="hljs-number">0</span>].length) {
      <span class="hljs-keyword">this</span>.tokens.push([<span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'void'</span>, <span class="hljs-keyword">this</span>.line], [<span class="hljs-string">'ASSIGN'</span>, <span class="hljs-string">'='</span>, <span class="hljs-keyword">this</span>.line]);
      <span class="hljs-keyword">this</span>.indent(index + that - <span class="hljs-number">1</span> - <span class="hljs-keyword">this</span>.dent - code.lastIndexOf(<span class="hljs-string">'\n'</span>, index - <span class="hljs-number">1</span>));
      <span class="hljs-keyword">return</span> that;
    }
    tag = able(<span class="hljs-keyword">this</span>.tokens) || <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'CREMENT'</span> &amp;&amp; able(<span class="hljs-keyword">this</span>.tokens, <span class="hljs-keyword">this</span>.tokens.length - <span class="hljs-number">1</span>) || <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span> ? <span class="hljs-string">'MATH'</span> : <span class="hljs-string">'STRNUM'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'@'</span>:
    <span class="hljs-keyword">this</span>.adi();
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'DOT'</span> &amp;&amp; <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'.'</span> &amp;&amp; (ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'ID'</span> &amp;&amp; (ref$ = <span class="hljs-keyword">this</span>.tokens)[ref$.length - <span class="hljs-number">2</span>][<span class="hljs-number">1</span>] === <span class="hljs-string">'constructor'</span>) {
      <span class="hljs-keyword">this</span>.tokens.pop();
      <span class="hljs-keyword">this</span>.tokens.pop();
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'this'</span>, <span class="hljs-literal">true</span>);
      <span class="hljs-keyword">this</span>.adi();
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'ID'</span>, <span class="hljs-string">'constructor'</span>, <span class="hljs-literal">true</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'this'</span>, <span class="hljs-literal">true</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'@@'</span>:
    <span class="hljs-keyword">this</span>.adi();
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'ID'</span>, <span class="hljs-string">'constructor'</span>, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&amp;'</span>:
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'arguments'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'!'</span>:
    <span class="hljs-keyword">switch</span> (<span class="hljs-literal">false</span>) {
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.last.spaced) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'require'</span>) {
          <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] = <span class="hljs-string">'REQUIRE'</span>;
          <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] = <span class="hljs-string">'require!'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (able(<span class="hljs-keyword">this</span>.tokens, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>)) {
          <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'CALL('</span>, <span class="hljs-string">'!'</span>);
          <span class="hljs-keyword">this</span>.token(<span class="hljs-string">')CALL'</span>, <span class="hljs-string">')'</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'typeof'</span>) {
          <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] = <span class="hljs-string">'classof'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'delete'</span>) {
          <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] = <span class="hljs-string">'jsdelete'</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
      }
    }
    tag = <span class="hljs-string">'UNARY'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'&amp;'</span>:
    <span class="hljs-keyword">if</span> (!able(<span class="hljs-keyword">this</span>.tokens)) {
      tag = <span class="hljs-string">'LITERAL'</span>;
    }
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'|'</span>:
    tag = <span class="hljs-string">'BITWISE'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'~'</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dotcat(val)) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    tag = <span class="hljs-string">'UNARY'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'::'</span>:
    <span class="hljs-keyword">this</span>.adi();
    val = <span class="hljs-string">'prototype'</span>;
    tag = <span class="hljs-string">'ID'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'=&gt;'</span>:
    <span class="hljs-keyword">this</span>.unline();
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">false</span>);
    tag = <span class="hljs-string">'THEN'</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^!?(?:--?|~~?)&gt;\*?$/</span>.test(val)) {
      <span class="hljs-keyword">this</span>.parameters(tag = <span class="hljs-string">'-&gt;'</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^&lt;(?:--?|~~?)$/</span>.test(val)) {
      <span class="hljs-keyword">this</span>.parameters(tag = <span class="hljs-string">'&lt;-'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">switch</span> (val.charAt(<span class="hljs-number">0</span>)) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'('</span>:
        <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'CALL('</span>, <span class="hljs-string">'('</span>);
        tag = <span class="hljs-string">')CALL'</span>;
        val = <span class="hljs-string">')'</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;'</span>:
        <span class="hljs-keyword">if</span> (val.length &lt; <span class="hljs-number">4</span>) {
          <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">'unterminated words'</span>);
        }
        <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'WORDS'</span>, val.slice(<span class="hljs-number">2</span>, -<span class="hljs-number">2</span>), <span class="hljs-keyword">this</span>.adi());
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countLines(val).length;
      }
    }
  }
  <span class="hljs-keyword">if</span> ((tag === <span class="hljs-string">'+-'</span> || tag === <span class="hljs-string">'COMPARE'</span> || tag === <span class="hljs-string">'LOGIC'</span> || tag === <span class="hljs-string">'MATH'</span> || tag === <span class="hljs-string">'POWER'</span> || tag === <span class="hljs-string">'SHIFT'</span> || tag === <span class="hljs-string">'BITWISE'</span> || tag === <span class="hljs-string">'CONCAT'</span> || tag === <span class="hljs-string">'COMPOSE'</span> || tag === <span class="hljs-string">'RELATION'</span> || tag === <span class="hljs-string">'PIPE'</span> || tag === <span class="hljs-string">'BACKPIPE'</span> || tag === <span class="hljs-string">'IMPORT'</span>) &amp;&amp; <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span>) {
    tag = tag === <span class="hljs-string">'BACKPIPE'</span> ? <span class="hljs-string">'BIOPBP'</span> : <span class="hljs-string">'BIOP'</span>;
  }
  <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">','</span> || tag === <span class="hljs-string">'CASE'</span> || tag === <span class="hljs-string">'PIPE'</span> || tag === <span class="hljs-string">'BACKPIPE'</span> || tag === <span class="hljs-string">'DOT'</span> || tag === <span class="hljs-string">'LOGIC'</span> || tag === <span class="hljs-string">'COMPARE'</span> || tag === <span class="hljs-string">'MATH'</span> || tag === <span class="hljs-string">'POWER'</span> || tag === <span class="hljs-string">'IMPORT'</span> || tag === <span class="hljs-string">'SHIFT'</span> || tag === <span class="hljs-string">'BITWISE'</span>) {
    <span class="hljs-keyword">this</span>.unline();
  }
  <span class="hljs-keyword">this</span>.token(tag, val);
  <span class="hljs-keyword">return</span> sym.length;
};
exports.token = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tag, value, callable)</span>{</span>
  <span class="hljs-keyword">this</span>.tokens.push(<span class="hljs-keyword">this</span>.last = [tag, value, <span class="hljs-keyword">this</span>.line]);
  <span class="hljs-keyword">if</span> (callable) {
    <span class="hljs-keyword">this</span>.last.callable = <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">return</span> value;
};
exports.indent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(delta)</span>{</span>
  <span class="hljs-keyword">this</span>.dent += delta;
  <span class="hljs-keyword">this</span>.dents.push(<span class="hljs-keyword">this</span>.token(<span class="hljs-string">'INDENT'</span>, delta));
  <span class="hljs-keyword">this</span>.closes.push(<span class="hljs-string">'DEDENT'</span>);
};
exports.dedent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(debt)</span>{</span>
  <span class="hljs-keyword">var</span> dent;
  <span class="hljs-keyword">this</span>.dent -= debt;
  <span class="hljs-keyword">while</span> (debt &gt; <span class="hljs-number">0</span> &amp;&amp; (dent = <span class="hljs-keyword">this</span>.dents.pop())) {
    <span class="hljs-keyword">if</span> (debt &lt; dent &amp;&amp; !<span class="hljs-keyword">this</span>.inter) {
      <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"unmatched dedent ("</span> + debt + <span class="hljs-string">" for "</span> + dent + <span class="hljs-string">")"</span>);
    }
    <span class="hljs-keyword">this</span>.pair(<span class="hljs-string">'DEDENT'</span>);
    debt -= <span class="hljs-keyword">typeof</span> dent === <span class="hljs-string">'number'</span> ? <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'DEDENT'</span>, dent) : dent;
  }
};
exports.newline = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> ref$;
  <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'\n'</span> || <span class="hljs-keyword">this</span>.tokens.push(<span class="hljs-keyword">this</span>.last = (ref$ = [<span class="hljs-string">'NEWLINE'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-keyword">this</span>.line], ref$.spaced = <span class="hljs-literal">true</span>, ref$));
};
exports.unline = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> ref$;
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.tokens[<span class="hljs-number">1</span>]) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) {
  <span class="hljs-keyword">case</span> <span class="hljs-string">'INDENT'</span>:
    (ref$ = <span class="hljs-keyword">this</span>.dents)[ref$.length - <span class="hljs-number">1</span>] += <span class="hljs-string">''</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">case</span> <span class="hljs-string">'NEWLINE'</span>:
    <span class="hljs-keyword">this</span>.tokens.length--;
  }
};
exports.parameters = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arrow, offset)</span>{</span>
  <span class="hljs-keyword">var</span> i$, ref$, i, t, ref1$;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">')'</span> &amp;&amp; <span class="hljs-string">')'</span> === <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>]) {
    <span class="hljs-keyword">this</span>.lpar[<span class="hljs-number">0</span>] = <span class="hljs-string">'PARAM('</span>;
    <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] = <span class="hljs-string">')PARAM'</span>;
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">if</span> (arrow === <span class="hljs-string">'-&gt;'</span>) {
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'PARAM('</span>, <span class="hljs-string">''</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">for</span> (i$ = (ref$ = <span class="hljs-keyword">this</span>.tokens).length - <span class="hljs-number">1</span>; i$ &gt;= <span class="hljs-number">0</span>; --i$) {
      i = i$;
      t = ref$[i$];
      <span class="hljs-keyword">if</span> ((ref1$ = t[<span class="hljs-number">0</span>]) === <span class="hljs-string">'NEWLINE'</span> || ref1$ === <span class="hljs-string">'INDENT'</span> || ref1$ === <span class="hljs-string">'THEN'</span> || ref1$ === <span class="hljs-string">'=&gt;'</span> || ref1$ === <span class="hljs-string">'('</span>) {
        <span class="hljs-keyword">break</span>;
      }
    }
    <span class="hljs-keyword">this</span>.tokens.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, [<span class="hljs-string">'PARAM('</span>, <span class="hljs-string">''</span>, t[<span class="hljs-number">2</span>]]);
  }
  <span class="hljs-keyword">if</span> (offset) {
    <span class="hljs-keyword">this</span>.tokens.splice(<span class="hljs-keyword">this</span>.tokens.length + offset, <span class="hljs-number">0</span>, [<span class="hljs-string">')PARAM'</span>, <span class="hljs-string">''</span>, t[<span class="hljs-number">2</span>]]);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.token(<span class="hljs-string">')PARAM'</span>, <span class="hljs-string">''</span>);
  }
};
exports.interpolate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str, idx, end)</span>{</span>
  <span class="hljs-keyword">var</span> parts, end0, pos, i, ch, c1, id, stringified, length, tag, e, delta, nested, clone, ref$;
  parts = [];
  end0 = end.charAt(<span class="hljs-number">0</span>);
  pos = <span class="hljs-number">0</span>;
  i = -<span class="hljs-number">1</span>;
  str = str.slice(idx + end.length);
  <span class="hljs-keyword">while</span> (ch = str.charAt(++i)) {
    <span class="hljs-keyword">switch</span> (ch) {
    <span class="hljs-keyword">case</span> end0:
      <span class="hljs-keyword">if</span> (end !== str.slice(i, i + end.length)) {
        <span class="hljs-keyword">continue</span>;
      }
      parts.push([<span class="hljs-string">'S'</span>, <span class="hljs-keyword">this</span>.countLines(str.slice(<span class="hljs-number">0</span>, i)), <span class="hljs-keyword">this</span>.line]);
      <span class="hljs-keyword">return</span> parts.size = pos + i + end.length, parts;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'#'</span>:
      c1 = str.charAt(i + <span class="hljs-number">1</span>);
      id = <span class="hljs-keyword">in</span>$(c1, [<span class="hljs-string">'@'</span>]) &amp;&amp; c1 || (ID.lastIndex = i + <span class="hljs-number">1</span>, ID).exec(str)[<span class="hljs-number">1</span>];
      <span class="hljs-keyword">if</span> (!(id || c1 === <span class="hljs-string">'{'</span>)) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'\\'</span>:
      ++i;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">if</span> (i || nested &amp;&amp; !stringified) {
      stringified = parts.push([<span class="hljs-string">'S'</span>, <span class="hljs-keyword">this</span>.countLines(str.slice(<span class="hljs-number">0</span>, i)), <span class="hljs-keyword">this</span>.line]);
    }
    <span class="hljs-keyword">if</span> (id) {
      length = id.length;
      <span class="hljs-keyword">if</span> (id === <span class="hljs-string">'@'</span>) {
        id = <span class="hljs-string">'this'</span>;
      }
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">in</span>$(id, [<span class="hljs-string">'this'</span>])) {
        tag = <span class="hljs-string">'LITERAL'</span>;
      } <span class="hljs-keyword">else</span> {
        id = camelize(id);
        <span class="hljs-keyword">try</span> {
          <span class="hljs-built_in">Function</span>(<span class="hljs-string">"'use strict'; var "</span> + id);
        } <span class="hljs-keyword">catch</span> (e$) {
          e = e$;
          <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"invalid variable interpolation \""</span> + id + <span class="hljs-string">"\""</span>);
        }
        tag = <span class="hljs-string">'ID'</span>;
      }
      str = str.slice(delta = i + <span class="hljs-number">1</span> + length);
      parts.push([<span class="hljs-string">'TOKENS'</span>, nested = [[tag, id, <span class="hljs-keyword">this</span>.line]]]);
    } <span class="hljs-keyword">else</span> {
      clone = (ref$ = clone$(exports), ref$.inter = <span class="hljs-literal">true</span>, ref$.emender = <span class="hljs-keyword">this</span>.emender, ref$);
      nested = clone.tokenize(str.slice(i + <span class="hljs-number">2</span>), {
        line: <span class="hljs-keyword">this</span>.line,
        raw: <span class="hljs-literal">true</span>
      });
      delta = str.length - clone.rest.length;
      str = clone.rest, <span class="hljs-keyword">this</span>.line = clone.line;
      <span class="hljs-keyword">while</span> (((ref$ = nested[<span class="hljs-number">0</span>]) != <span class="hljs-literal">null</span> ? ref$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'NEWLINE'</span>) {
        nested.shift();
      }
      <span class="hljs-keyword">if</span> (nested.length) {
        nested.unshift([<span class="hljs-string">'('</span>, <span class="hljs-string">'('</span>, nested[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]]);
        nested.push([<span class="hljs-string">')'</span>, <span class="hljs-string">')'</span>, <span class="hljs-keyword">this</span>.line]);
        parts.push([<span class="hljs-string">'TOKENS'</span>, nested]);
      }
    }
    pos += delta;
    i = -<span class="hljs-number">1</span>;
  }
  <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"missing `"</span> + end + <span class="hljs-string">"`"</span>);
};
exports.addInterpolated = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(parts, nlines)</span>{</span>
  <span class="hljs-keyword">var</span> tokens, last, ref$, left, right, joint, callable, i$, len$, i, t;
  <span class="hljs-keyword">if</span> (!parts[<span class="hljs-number">1</span>]) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.strnum(nlines(<span class="hljs-keyword">this</span>.string(<span class="hljs-string">'"'</span>, parts[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>])));
  }
  tokens = <span class="hljs-keyword">this</span>.tokens, last = <span class="hljs-keyword">this</span>.last;
  ref$ = !last.spaced &amp;&amp; last[<span class="hljs-number">1</span>] === <span class="hljs-string">'%'</span>
    ? (--tokens.length, <span class="hljs-keyword">this</span>.last = last = tokens[tokens.length - <span class="hljs-number">1</span>], [<span class="hljs-string">'['</span>, <span class="hljs-string">']'</span>, [<span class="hljs-string">','</span>, <span class="hljs-string">','</span>]])
    : [<span class="hljs-string">'('</span>, <span class="hljs-string">')'</span>, [<span class="hljs-string">'+-'</span>, <span class="hljs-string">'+'</span>]], left = ref$[<span class="hljs-number">0</span>], right = ref$[<span class="hljs-number">1</span>], joint = ref$[<span class="hljs-number">2</span>];
  callable = <span class="hljs-keyword">this</span>.adi();
  tokens.push([left, <span class="hljs-string">'"'</span>, last[<span class="hljs-number">2</span>]]);
  <span class="hljs-keyword">for</span> (i$ = <span class="hljs-number">0</span>, len$ = parts.length; i$ &lt; len$; ++i$) {
    i = i$;
    t = parts[i$];
    <span class="hljs-keyword">if</span> (t[<span class="hljs-number">0</span>] === <span class="hljs-string">'TOKENS'</span>) {
      tokens.push.apply(tokens, t[<span class="hljs-number">1</span>]);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">1</span> &amp;&amp; !t[<span class="hljs-number">1</span>]) {
        <span class="hljs-keyword">continue</span>;
      }
      tokens.push([<span class="hljs-string">'STRNUM'</span>, nlines(<span class="hljs-keyword">this</span>.string(<span class="hljs-string">'"'</span>, t[<span class="hljs-number">1</span>])), t[<span class="hljs-number">2</span>]]);
    }
    tokens.push(joint.concat(tokens[tokens.length - <span class="hljs-number">1</span>][<span class="hljs-number">2</span>]));
  }
  --tokens.length;
  <span class="hljs-keyword">this</span>.token(right, <span class="hljs-string">''</span>, callable);
};
exports.strnum = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'STRNUM'</span>, it, <span class="hljs-keyword">this</span>.adi() || <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'DOT'</span>);
};
exports.regex = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(body, flag)</span>{</span>
  <span class="hljs-keyword">var</span> e;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-built_in">RegExp</span>(body);
  } <span class="hljs-keyword">catch</span> (e$) {
    e = e$;
    <span class="hljs-keyword">this</span>.carp(e.message);
  }
  <span class="hljs-keyword">if</span> (flag === <span class="hljs-string">'$'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.strnum(<span class="hljs-keyword">this</span>.string(<span class="hljs-string">'\''</span>, enslash(body)));
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">"/"</span> + (body || <span class="hljs-string">'(?:)'</span>) + <span class="hljs-string">"/"</span> + <span class="hljs-keyword">this</span>.validate(flag));
};
exports.adi = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last.spaced) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">if</span> (!able(<span class="hljs-keyword">this</span>.tokens)) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.token(<span class="hljs-string">'DOT'</span>, <span class="hljs-string">'.'</span>);
};
exports.dotcat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] === <span class="hljs-string">'.'</span> || <span class="hljs-keyword">this</span>.adi()) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.last[<span class="hljs-number">1</span>] += it;
  }
};
exports.pair = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">var</span> wanted, ref$;
  <span class="hljs-keyword">if</span> (!(it === (wanted = (ref$ = <span class="hljs-keyword">this</span>.closes)[ref$.length - <span class="hljs-number">1</span>]) || <span class="hljs-string">')CALL'</span> === wanted &amp;&amp; it === <span class="hljs-string">')'</span>)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'DEDENT'</span> !== wanted) {
      <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"unmatched `"</span> + it + <span class="hljs-string">"`"</span>);
    }
    <span class="hljs-keyword">this</span>.dedent((ref$ = <span class="hljs-keyword">this</span>.dents)[ref$.length - <span class="hljs-number">1</span>]);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.pair(it);
  }
  <span class="hljs-keyword">this</span>.unline();
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.closes.pop();
};
exports.able = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(call)</span>{</span>
  <span class="hljs-keyword">return</span> !<span class="hljs-keyword">this</span>.last.spaced &amp;&amp; able(<span class="hljs-keyword">this</span>.tokens, <span class="hljs-literal">null</span>, call);
};
exports.countLines = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">var</span> pos;
  <span class="hljs-keyword">while</span> (pos = <span class="hljs-number">1</span> + it.indexOf(<span class="hljs-string">'\n'</span>, pos)) {
    ++<span class="hljs-keyword">this</span>.line;
  }
  <span class="hljs-keyword">return</span> it;
};
exports.forange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> ref$, ref1$, ref2$;
  <span class="hljs-keyword">if</span> (((ref$ = (ref1$ = <span class="hljs-keyword">this</span>.tokens)[ref1$.length - <span class="hljs-number">2</span> - ((ref2$ = <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>]) === <span class="hljs-string">'NEWLINE'</span> || ref2$ === <span class="hljs-string">'INDENT'</span>)]) != <span class="hljs-literal">null</span> ? ref$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'FOR'</span> || <span class="hljs-keyword">this</span>.last[<span class="hljs-number">0</span>] === <span class="hljs-string">'FOR'</span>) {
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'for'</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">this</span>.fset(<span class="hljs-string">'from'</span>, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
};
exports.validate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(flag)</span>{</span>
  <span class="hljs-keyword">var</span> that;
  <span class="hljs-keyword">if</span> (that = flag &amp;&amp; <span class="hljs-regexp">/(.).*\1/</span>.exec(flag)) {
    <span class="hljs-keyword">this</span>.carp(<span class="hljs-string">"duplicate regex flag `"</span> + that[<span class="hljs-number">1</span>] + <span class="hljs-string">"`"</span>);
  }
  <span class="hljs-keyword">return</span> flag;
};
exports.fget = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
  <span class="hljs-keyword">var</span> ref$;
  <span class="hljs-keyword">return</span> (ref$ = <span class="hljs-keyword">this</span>.flags[<span class="hljs-keyword">this</span>.closes.length]) != <span class="hljs-literal">null</span> ? ref$[key] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>;
};
exports.fset = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, val)</span>{</span>
  <span class="hljs-keyword">var</span> ref$, key$;
  ((ref$ = <span class="hljs-keyword">this</span>.flags)[key$ = <span class="hljs-keyword">this</span>.closes.length] || (ref$[key$] = {}))[key] = val;
};
exports.carp = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  carp(it, <span class="hljs-keyword">this</span>.line);
};
exports.string = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(q, body)</span>{</span>
  <span class="hljs-keyword">return</span> string(q, body, <span class="hljs-keyword">this</span>.line);
};
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">carp</span><span class="hljs-params">(msg, lno)</span>{</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-built_in">SyntaxError</span>(msg + <span class="hljs-string">" on line "</span> + (-~lno));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">able</span><span class="hljs-params">(tokens, i, call)</span>{</span>
  <span class="hljs-keyword">var</span> token, tag;
  i == <span class="hljs-literal">null</span> &amp;&amp; (i = tokens.length);
  tag = (token = tokens[i - <span class="hljs-number">1</span>])[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">return</span> (tag === <span class="hljs-string">'ID'</span> || tag === <span class="hljs-string">']'</span> || tag === <span class="hljs-string">'?'</span>) || (call
    ? token.callable || (tag === <span class="hljs-string">')'</span> || tag === <span class="hljs-string">')CALL'</span> || tag === <span class="hljs-string">'BIOPBP'</span>) &amp;&amp; token[<span class="hljs-number">1</span>]
    : tag === <span class="hljs-string">'}'</span> || tag === <span class="hljs-string">')'</span> || tag === <span class="hljs-string">')CALL'</span> || tag === <span class="hljs-string">'STRNUM'</span> || tag === <span class="hljs-string">'LITERAL'</span> || tag === <span class="hljs-string">'WORDS'</span>);
}
string = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(re)</span>{</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(q, body, lno)</span>{</span>
    body = body.replace(re, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it, oct, xu, rest)</span>{</span>
      <span class="hljs-keyword">if</span> (it === q || it === <span class="hljs-string">'\\'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'\\'</span> + it;
      }
      <span class="hljs-keyword">if</span> (oct) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'\\x'</span> + (<span class="hljs-number">0x100</span> + <span class="hljs-built_in">parseInt</span>(oct, <span class="hljs-number">8</span>)).toString(<span class="hljs-number">16</span>).slice(<span class="hljs-number">1</span>);
      }
      <span class="hljs-keyword">if</span> (xu) {
        carp(<span class="hljs-string">'malformed character escape sequence'</span>, lno);
      }
      <span class="hljs-keyword">if</span> (!rest || q === rest) {
        <span class="hljs-keyword">return</span> it;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> rest;
      }
    });
    <span class="hljs-keyword">return</span> q + body + q;
  };
}.call(<span class="hljs-keyword">this</span>, <span class="hljs-regexp">/['"]|\\(?:([0-3]?[0-7]{2}|[1-7]|0(?=[89]))|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|([xu])|[\\0bfnrtv]|[^\n\S]|([\w\W]))?/g</span>));
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">heretabs</span><span class="hljs-params">(doc)</span>{</span>
  <span class="hljs-keyword">var</span> dent, that, ref$;
  dent = <span class="hljs-number">0</span> / <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (that = TABS.exec(doc)) {
    dent &lt;= (ref$ = that[<span class="hljs-number">0</span>].length - <span class="hljs-number">1</span>) || (dent = ref$);
  }
  <span class="hljs-keyword">return</span> dent;
}
TABS = <span class="hljs-regexp">/\n(?!$)[^\n\S]*/mg</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detab</span><span class="hljs-params">(str, len)</span>{</span>
  <span class="hljs-keyword">if</span> (len) {
    <span class="hljs-keyword">return</span> str.replace(detab[len] || (detab[len] = <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'\\n[^\\n\\S]{1,'</span> + len + <span class="hljs-string">'}'</span>, <span class="hljs-string">'g'</span>)), <span class="hljs-string">'\n'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> str;
  }
}
unlines = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">return</span> it.replace(<span class="hljs-regexp">/\n[^\n\S]*/g</span>, <span class="hljs-string">''</span>);
};
enlines = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">return</span> it.replace(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">'\\n'</span>);
};
enslash = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">return</span> it.replace(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">'\\\\'</span>);
};
reslash = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">return</span> it.replace(<span class="hljs-regexp">/(\\.)|\//g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] || <span class="hljs-string">'\\/'</span>;
  });
};
camelize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">return</span> it.replace(<span class="hljs-regexp">/-[a-z]/ig</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
    <span class="hljs-keyword">return</span> it.charAt(<span class="hljs-number">1</span>).toUpperCase();
  });
};
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lchomp</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">return</span> it.slice(<span class="hljs-number">1</span> + it.lastIndexOf(<span class="hljs-string">'\n'</span>, <span class="hljs-number">0</span>));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span><span class="hljs-params">(val, lno)</span>{</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(val)) {
    <span class="hljs-keyword">return</span> [+val];
  }
  val = val.length &gt; <span class="hljs-number">8</span>
    ? <span class="hljs-string">'ng'</span>
    : <span class="hljs-built_in">Function</span>(<span class="hljs-string">'return '</span> + val)();
  val.length === <span class="hljs-number">1</span> || carp(<span class="hljs-string">'bad string in range'</span>, lno);
  <span class="hljs-keyword">return</span> [val.charCodeAt(), <span class="hljs-literal">true</span>];
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uxxxx</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">'"\\u'</span> + (<span class="hljs-string">'000'</span> + it.toString(<span class="hljs-number">16</span>)).slice(-<span class="hljs-number">4</span>) + <span class="hljs-string">'"'</span>;
}
character = <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">JSON</span> == <span class="hljs-string">'undefined'</span> || <span class="hljs-built_in">JSON</span> === <span class="hljs-literal">null</span>
  ? uxxxx
  : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(it)</span>{</span>
    <span class="hljs-keyword">switch</span> (it) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">0x2028</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">0x2029</span>:
      <span class="hljs-keyword">return</span> uxxxx(it);
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-built_in">String</span>.fromCharCode(it));
    }
  };
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">firstPass</span><span class="hljs-params">(tokens)</span>{</span>
  <span class="hljs-keyword">var</span> prev, i, token, tag, val, line, next, ts, parens, i$, j;
  prev = [<span class="hljs-string">'NEWLINE'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-number">0</span>];
  i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (token = tokens[++i]) {
    tag = token[<span class="hljs-number">0</span>], val = token[<span class="hljs-number">1</span>], line = token[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">switch</span> (<span class="hljs-literal">false</span>) {
    <span class="hljs-keyword">case</span> !(tag === <span class="hljs-string">'ASSIGN'</span> &amp;&amp; <span class="hljs-keyword">in</span>$(prev[<span class="hljs-number">1</span>], LS_KEYWORDS) &amp;&amp; tokens[i - <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] !== <span class="hljs-string">'DOT'</span>):
      carp(<span class="hljs-string">"cannot assign to reserved word \""</span> + prev[<span class="hljs-number">1</span>] + <span class="hljs-string">"\""</span>, line);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> !(tag === <span class="hljs-string">'DOT'</span> &amp;&amp; prev[<span class="hljs-number">0</span>] === <span class="hljs-string">']'</span> &amp;&amp; tokens[i - <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'['</span> &amp;&amp; tokens[i - <span class="hljs-number">3</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'DOT'</span>):
      tokens.splice(i - <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
      tokens[i - <span class="hljs-number">3</span>][<span class="hljs-number">1</span>] = <span class="hljs-string">'[]'</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> !(tag === <span class="hljs-string">'DOT'</span> &amp;&amp; prev[<span class="hljs-number">0</span>] === <span class="hljs-string">'}'</span> &amp;&amp; tokens[i - <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'{'</span> &amp;&amp; tokens[i - <span class="hljs-number">3</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'DOT'</span>):
      tokens.splice(i - <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
      tokens[i - <span class="hljs-number">3</span>][<span class="hljs-number">1</span>] = <span class="hljs-string">'{}'</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> !(val === <span class="hljs-string">'.'</span> &amp;&amp; token.spaced &amp;&amp; prev.spaced):
      tokens[i] = [<span class="hljs-string">'COMPOSE'</span>, <span class="hljs-string">'&lt;&lt;'</span>, line];
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> val !== <span class="hljs-string">'++'</span>:
      <span class="hljs-keyword">if</span> (!(next = tokens[i + <span class="hljs-number">1</span>])) {
        <span class="hljs-keyword">break</span>;
      }
      ts = [<span class="hljs-string">'ID'</span>, <span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'STRNUM'</span>];
      <span class="hljs-keyword">if</span> (prev.spaced &amp;&amp; token.spaced || !(prev.spaced || token.spaced) &amp;&amp; <span class="hljs-keyword">in</span>$(prev[<span class="hljs-number">0</span>], ts) &amp;&amp; <span class="hljs-keyword">in</span>$(next[<span class="hljs-number">0</span>], ts)) {
        tokens[i][<span class="hljs-number">0</span>] = <span class="hljs-string">'CONCAT'</span>;
      }
      <span class="hljs-keyword">if</span> (prev[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span> &amp;&amp; next[<span class="hljs-number">0</span>] === <span class="hljs-string">')'</span> || prev[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span> &amp;&amp; token.spaced || next[<span class="hljs-number">0</span>] === <span class="hljs-string">')'</span> &amp;&amp; prev.spaced) {
        tokens[i][<span class="hljs-number">0</span>] = <span class="hljs-string">'BIOP'</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> tag !== <span class="hljs-string">'DOT'</span>:
      next = tokens[i + <span class="hljs-number">1</span>];
      <span class="hljs-keyword">if</span> (prev[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span> &amp;&amp; next[<span class="hljs-number">0</span>] === <span class="hljs-string">')'</span>) {
        tokens[i][<span class="hljs-number">0</span>] = <span class="hljs-string">'BIOP'</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prev[<span class="hljs-number">0</span>] === <span class="hljs-string">'('</span>) {
        tokens.splice(i, <span class="hljs-number">0</span>, [<span class="hljs-string">'PARAM('</span>, <span class="hljs-string">'('</span>, line], [<span class="hljs-string">')PARAM'</span>, <span class="hljs-string">')'</span>, line], [<span class="hljs-string">'-&gt;'</span>, <span class="hljs-string">'-&gt;'</span>, line], [<span class="hljs-string">'ID'</span>, <span class="hljs-string">'it'</span>, line]);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (next[<span class="hljs-number">0</span>] === <span class="hljs-string">')'</span>) {
        tokens.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, [<span class="hljs-string">'['</span>, <span class="hljs-string">'['</span>, line], [<span class="hljs-string">'ID'</span>, <span class="hljs-string">'it'</span>, line], [<span class="hljs-string">']'</span>, <span class="hljs-string">']'</span>, line]);
        parens = <span class="hljs-number">1</span>;
        LOOP: <span class="hljs-keyword">for</span> (i$ = i + <span class="hljs-number">1</span>; i$ &gt;= <span class="hljs-number">0</span>; --i$) {
          j = i$;
          <span class="hljs-keyword">switch</span> (tokens[j][<span class="hljs-number">0</span>]) {
          <span class="hljs-keyword">case</span> <span class="hljs-string">')'</span>:
            ++parens;
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'('</span>:
            <span class="hljs-keyword">if</span> (--parens === <span class="hljs-number">0</span>) {
              tokens.splice(j + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, [<span class="hljs-string">'PARAM('</span>, <span class="hljs-string">'('</span>, line], [<span class="hljs-string">'ID'</span>, <span class="hljs-string">'it'</span>, line], [<span class="hljs-string">')PARAM'</span>, <span class="hljs-string">')'</span>, line], [<span class="hljs-string">'-&gt;'</span>, <span class="hljs-string">'-&gt;'</span>, line]);
              <span class="hljs-keyword">break</span> LOOP;
            }
          }
        }
      }
    }
    prev = token;
    <span class="hljs-keyword">continue</span>;
  }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rewriteBlockless</span><span class="hljs-params">(tokens)</span>{</span>
  <span class="hljs-keyword">var</span> i$, len$, i, token, tag;
  <span class="hljs-keyword">for</span> (i$ = <span class="hljs-number">0</span>, len$ = tokens.length; i$ &lt; len$; ++i$) {
    i = i$;
    token = tokens[i$], tag = token[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'IF'</span> || tag === <span class="hljs-string">'CLASS'</span> || tag === <span class="hljs-string">'CATCH'</span>) {
      detectEnd(tokens, i + <span class="hljs-number">1</span>, ok, go);
    }
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ok</span><span class="hljs-params">(it)</span>{</span>
    <span class="hljs-keyword">var</span> ref$;
    <span class="hljs-keyword">return</span> (ref$ = it[<span class="hljs-number">0</span>]) === <span class="hljs-string">'NEWLINE'</span> || ref$ === <span class="hljs-string">'INDENT'</span>;
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span><span class="hljs-params">(it, i)</span>{</span>
    <span class="hljs-keyword">var</span> lno;
    <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'IF'</span>) {
      <span class="hljs-keyword">if</span> (it[<span class="hljs-number">0</span>] !== <span class="hljs-string">'INDENT'</span> || !it[<span class="hljs-number">1</span>] &amp;&amp; !it.then || <span class="hljs-keyword">in</span>$(tokens[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>], BLOCK_USERS)) {
        token[<span class="hljs-number">0</span>] = <span class="hljs-string">'POST_IF'</span>;
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (it[<span class="hljs-number">0</span>] !== <span class="hljs-string">'INDENT'</span>) {
      tokens.splice(i, <span class="hljs-number">0</span>, [<span class="hljs-string">'INDENT'</span>, <span class="hljs-number">0</span>, lno = tokens[i - <span class="hljs-number">1</span>][<span class="hljs-number">2</span>]], [<span class="hljs-string">'DEDENT'</span>, <span class="hljs-number">0</span>, lno]);
    }
  }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addImplicitIndentation</span><span class="hljs-params">(tokens)</span>{</span>
  <span class="hljs-keyword">var</span> i, token, tag, next, indent, dedent, ref$, ref1$, idx;
  i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (token = tokens[++i]) {
    tag = token[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (tag !== <span class="hljs-string">'-&gt;'</span> &amp;&amp; tag !== <span class="hljs-string">'THEN'</span> &amp;&amp; tag !== <span class="hljs-string">'ELSE'</span> &amp;&amp; tag !== <span class="hljs-string">'DEFAULT'</span> &amp;&amp; tag !== <span class="hljs-string">'TRY'</span> &amp;&amp; tag !== <span class="hljs-string">'FINALLY'</span> &amp;&amp; tag !== <span class="hljs-string">'DECL'</span>) {
      <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">switch</span> (next = tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">0</span>]) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'IF'</span>:
      <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'ELSE'</span>) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'INDENT'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'THEN'</span>:
      <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'THEN'</span>) {
        tokens.splice(i--, <span class="hljs-number">1</span>);
      }
      <span class="hljs-keyword">continue</span>;
    }
    indent = [<span class="hljs-string">'INDENT'</span>, <span class="hljs-number">0</span>, token[<span class="hljs-number">2</span>]];
    dedent = [<span class="hljs-string">'DEDENT'</span>, <span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'THEN'</span>) {
      (tokens[i] = indent).then = <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
      tokens.splice(++i, <span class="hljs-number">0</span>, indent);
    }
    <span class="hljs-keyword">switch</span> (<span class="hljs-literal">false</span>) {
    <span class="hljs-keyword">case</span> tag !== <span class="hljs-string">'DECL'</span>:
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> next !== <span class="hljs-string">'DOT'</span> &amp;&amp; next !== <span class="hljs-string">'?'</span> &amp;&amp; next !== <span class="hljs-string">','</span> &amp;&amp; next !== <span class="hljs-string">'PIPE'</span> &amp;&amp; next !== <span class="hljs-string">'BACKPIPE'</span>:
      --i;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">case</span> !((next === <span class="hljs-string">'ID'</span> || next === <span class="hljs-string">'STRNUM'</span> || next === <span class="hljs-string">'LITERAL'</span>) &amp;&amp; <span class="hljs-string">','</span> === ((ref$ = tokens[i + <span class="hljs-number">2</span>]) != <span class="hljs-literal">null</span> ? ref$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>)):
      go(<span class="hljs-number">0</span>, i += <span class="hljs-number">2</span>);
      ++i;
      <span class="hljs-keyword">continue</span>;
    <span class="hljs-keyword">case</span> !((next === <span class="hljs-string">'('</span> || next === <span class="hljs-string">'['</span> || next === <span class="hljs-string">'{'</span>) &amp;&amp; <span class="hljs-string">','</span> === ((ref1$ = tokens[idx = <span class="hljs-number">1</span> + indexOfPair(tokens, i + <span class="hljs-number">1</span>)]) != <span class="hljs-literal">null</span> ? ref1$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>)):
      go(<span class="hljs-number">0</span>, idx);
      ++i;
      <span class="hljs-keyword">continue</span>;
    }
    detectEnd(tokens, i + <span class="hljs-number">1</span>, ok, go);
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ok</span><span class="hljs-params">(token, i)</span>{</span>
    <span class="hljs-keyword">var</span> t0, t;
    t0 = token[<span class="hljs-number">0</span>];
    t = tag;
    <span class="hljs-keyword">if</span> (tag === t0 || tag === <span class="hljs-string">'THEN'</span> &amp;&amp; t0 === <span class="hljs-string">'SWITCH'</span>) {
      tag = <span class="hljs-string">''</span>;
    }
    <span class="hljs-keyword">switch</span> (t0) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'NEWLINE'</span>:
      <span class="hljs-keyword">return</span> token[<span class="hljs-number">1</span>] !== <span class="hljs-string">';'</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'DOT'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'?'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">','</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'PIPE'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'BACKPIPE'</span>:
      <span class="hljs-keyword">return</span> tokens[i - <span class="hljs-number">1</span>].eol;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'ELSE'</span>:
      <span class="hljs-keyword">return</span> t === <span class="hljs-string">'THEN'</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CATCH'</span>:
      <span class="hljs-keyword">return</span> t === <span class="hljs-string">'TRY'</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'FINALLY'</span>:
      <span class="hljs-keyword">return</span> t === <span class="hljs-string">'TRY'</span> || t === <span class="hljs-string">'CATCH'</span> || t === <span class="hljs-string">'THEN'</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CASE'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'DEFAULT'</span>:
      <span class="hljs-keyword">return</span> t === <span class="hljs-string">'CASE'</span> || t === <span class="hljs-string">'THEN'</span>;
    }
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span><span class="hljs-params">(arg$, i)</span>{</span>
    <span class="hljs-keyword">var</span> prev;
    prev = tokens[i - <span class="hljs-number">1</span>];
    tokens.splice(prev[<span class="hljs-number">0</span>] === <span class="hljs-string">','</span> ? i - <span class="hljs-number">1</span> : i, <span class="hljs-number">0</span>, (dedent[<span class="hljs-number">2</span>] = prev[<span class="hljs-number">2</span>], dedent));
  }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addImplicitParentheses</span><span class="hljs-params">(tokens)</span>{</span>
  <span class="hljs-keyword">var</span> i, brackets, token, endi, ref$, tpair, tag, prev, ref1$, skipBlock, seenSwitch;
  i = <span class="hljs-number">0</span>;
  brackets = [];
  <span class="hljs-keyword">while</span> (token = tokens[++i]) {
    <span class="hljs-keyword">if</span> (token[<span class="hljs-number">1</span>] === <span class="hljs-string">'do'</span> &amp;&amp; tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'INDENT'</span>) {
      endi = indexOfPair(tokens, i + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (tokens[endi + <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'NEWLINE'</span> &amp;&amp; ((ref$ = tokens[endi + <span class="hljs-number">2</span>]) != <span class="hljs-literal">null</span> ? ref$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'WHILE'</span>) {
        token[<span class="hljs-number">0</span>] = <span class="hljs-string">'DO'</span>;
        tokens[endi + <span class="hljs-number">2</span>].done = <span class="hljs-literal">true</span>;
        tokens.splice(endi + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
      } <span class="hljs-keyword">else</span> {
        (token = tokens[<span class="hljs-number">1</span> + i])[<span class="hljs-number">0</span>] = <span class="hljs-string">'('</span>;
        (tpair = tokens[endi])[<span class="hljs-number">0</span>] = <span class="hljs-string">')'</span>;
        token.doblock = <span class="hljs-literal">true</span>;
        tokens.splice(i, <span class="hljs-number">1</span>);
      }
    }
    tag = token[<span class="hljs-number">0</span>];
    prev = tokens[i - <span class="hljs-number">1</span>];
    tag === <span class="hljs-string">'['</span> &amp;&amp; brackets.push(prev[<span class="hljs-number">0</span>] === <span class="hljs-string">'DOT'</span>);
    <span class="hljs-keyword">if</span> (prev[<span class="hljs-number">0</span>] === <span class="hljs-string">']'</span>) {
      <span class="hljs-keyword">if</span> (brackets.pop()) {
        prev.index = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">continue</span>;
      }
    }
    <span class="hljs-keyword">if</span> (!(((ref1$ = prev[<span class="hljs-number">0</span>]) === <span class="hljs-string">'FUNCTION'</span> || ref1$ === <span class="hljs-string">'GENERATOR'</span> || ref1$ === <span class="hljs-string">'LET'</span> || ref1$ === <span class="hljs-string">'WHERE'</span>) || prev.spaced &amp;&amp; able(tokens, i, <span class="hljs-literal">true</span>))) {
      <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">if</span> (token.doblock) {
      token[<span class="hljs-number">0</span>] = <span class="hljs-string">'CALL('</span>;
      tpair[<span class="hljs-number">0</span>] = <span class="hljs-string">')CALL'</span>;
      <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">if</span> (!exp(token)) {
      <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'CREMENT'</span>) {
      <span class="hljs-keyword">if</span> (token.spaced || !<span class="hljs-keyword">in</span>$((ref1$ = tokens[i + <span class="hljs-number">1</span>]) != <span class="hljs-literal">null</span> ? ref1$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>, CHAIN)) {
        <span class="hljs-keyword">continue</span>;
      }
    }
    skipBlock = seenSwitch = <span class="hljs-literal">false</span>;
    tokens.splice(i++, <span class="hljs-number">0</span>, [<span class="hljs-string">'CALL('</span>, <span class="hljs-string">''</span>, token[<span class="hljs-number">2</span>]]);
    detectEnd(tokens, i, ok, go);
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exp</span><span class="hljs-params">(token)</span>{</span>
    <span class="hljs-keyword">var</span> tag;
    tag = token[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">in</span>$(tag, ARG) || !token.spaced &amp;&amp; (tag === <span class="hljs-string">'+-'</span> || tag === <span class="hljs-string">'CLONE'</span>);
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ok</span><span class="hljs-params">(token, i)</span>{</span>
    <span class="hljs-keyword">var</span> tag, ref$, pre;
    tag = token[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'POST_IF'</span> || tag === <span class="hljs-string">'PIPE'</span> || tag === <span class="hljs-string">'BACKPIPE'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">if</span> (!skipBlock) {
      <span class="hljs-keyword">if</span> (token.alias &amp;&amp; ((ref$ = token[<span class="hljs-number">1</span>]) === <span class="hljs-string">'&amp;&amp;'</span> || ref$ === <span class="hljs-string">'||'</span> || ref$ === <span class="hljs-string">'xor'</span>) || (tag === <span class="hljs-string">'TO'</span> || tag === <span class="hljs-string">'BY'</span> || tag === <span class="hljs-string">'IMPLEMENTS'</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
    }
    pre = tokens[i - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">switch</span> (tag) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'NEWLINE'</span>:
      <span class="hljs-keyword">return</span> pre[<span class="hljs-number">0</span>] !== <span class="hljs-string">','</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'DOT'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'?'</span>:
      <span class="hljs-keyword">return</span> !skipBlock &amp;&amp; (pre.spaced || pre[<span class="hljs-number">0</span>] === <span class="hljs-string">'DEDENT'</span>);
    <span class="hljs-keyword">case</span> <span class="hljs-string">'SWITCH'</span>:
      seenSwitch = <span class="hljs-literal">true</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">case</span> <span class="hljs-string">'IF'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CLASS'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'FUNCTION'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'GENERATOR'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'LET'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'WITH'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CATCH'</span>:
      skipBlock = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CASE'</span>:
      <span class="hljs-keyword">if</span> (seenSwitch) {
        skipBlock = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'INDENT'</span>:
      <span class="hljs-keyword">if</span> (skipBlock) {
        <span class="hljs-keyword">return</span> skipBlock = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">return</span> !<span class="hljs-keyword">in</span>$(pre[<span class="hljs-number">0</span>], BLOCK_USERS);
    <span class="hljs-keyword">case</span> <span class="hljs-string">'WHILE'</span>:
      <span class="hljs-keyword">if</span> (token.done) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">case</span> <span class="hljs-string">'FOR'</span>:
      skipBlock = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span> able(tokens, i) || pre[<span class="hljs-number">0</span>] === <span class="hljs-string">'CREMENT'</span> || pre[<span class="hljs-number">0</span>] === <span class="hljs-string">'...'</span> &amp;&amp; pre.spaced;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span><span class="hljs-params">(token, i)</span>{</span>
    tokens.splice(i, <span class="hljs-number">0</span>, [<span class="hljs-string">')CALL'</span>, <span class="hljs-string">''</span>, tokens[i - <span class="hljs-number">1</span>][<span class="hljs-number">2</span>]]);
  }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addImplicitBraces</span><span class="hljs-params">(tokens)</span>{</span>
  <span class="hljs-keyword">var</span> stack, i, token, tag, start, paren, index, pre, ref$, inline, ref1$;
  stack = [];
  i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (token = tokens[++i]) {
    <span class="hljs-keyword">if</span> (<span class="hljs-string">':'</span> !== (tag = token[<span class="hljs-number">0</span>])) {
      <span class="hljs-keyword">switch</span> (<span class="hljs-literal">false</span>) {
      <span class="hljs-keyword">case</span> !<span class="hljs-keyword">in</span>$(tag, CLOSERS):
        start = stack.pop();
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> !<span class="hljs-keyword">in</span>$(tag, OPENERS):
        <span class="hljs-keyword">if</span> (tag === <span class="hljs-string">'INDENT'</span> &amp;&amp; tokens[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'{'</span>) {
          tag = <span class="hljs-string">'{'</span>;
        }
        stack.push([tag, i]);
      }
      <span class="hljs-keyword">continue</span>;
    }
    paren = tokens[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">')'</span>;
    index = paren
      ? start[<span class="hljs-number">1</span>]
      : i - <span class="hljs-number">1</span>;
    pre = tokens[index - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (!(((ref$ = pre[<span class="hljs-number">0</span>]) === <span class="hljs-string">':'</span> || ref$ === <span class="hljs-string">'ASSIGN'</span> || ref$ === <span class="hljs-string">'IMPORT'</span>) || ((ref$ = stack[stack.length - <span class="hljs-number">1</span>]) != <span class="hljs-literal">null</span> ? ref$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) !== <span class="hljs-string">'{'</span>)) {
      <span class="hljs-keyword">continue</span>;
    }
    stack.push([<span class="hljs-string">'{'</span>]);
    inline = !pre.doblock &amp;&amp; ((ref1$ = pre[<span class="hljs-number">0</span>]) !== <span class="hljs-string">'NEWLINE'</span> &amp;&amp; ref1$ !== <span class="hljs-string">'INDENT'</span>);
    <span class="hljs-keyword">while</span> (((ref1$ = tokens[index - <span class="hljs-number">2</span>]) != <span class="hljs-literal">null</span> ? ref1$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'COMMENT'</span>) {
      index -= <span class="hljs-number">2</span>;
    }
    tokens.splice(index, <span class="hljs-number">0</span>, [<span class="hljs-string">'{'</span>, <span class="hljs-string">'{'</span>, tokens[index][<span class="hljs-number">2</span>]]);
    detectEnd(tokens, ++i + <span class="hljs-number">1</span>, ok, go);
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ok</span><span class="hljs-params">(token, i)</span>{</span>
    <span class="hljs-keyword">var</span> tag, t1, ref$, ref1$;
    <span class="hljs-keyword">switch</span> (tag = token[<span class="hljs-number">0</span>]) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">','</span>:
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'NEWLINE'</span>:
      <span class="hljs-keyword">if</span> (inline) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'DEDENT'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'POST_IF'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'FOR'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'WHILE'</span>:
      <span class="hljs-keyword">return</span> inline;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    t1 = (ref$ = tokens[i + <span class="hljs-number">1</span>]) != <span class="hljs-literal">null</span> ? ref$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>;
    <span class="hljs-keyword">return</span> t1 !== (tag === <span class="hljs-string">','</span> ? <span class="hljs-string">'NEWLINE'</span> : <span class="hljs-string">'COMMENT'</span>) &amp;&amp; <span class="hljs-string">':'</span> !== ((ref1$ = tokens[t1 === <span class="hljs-string">'('</span>
      ? <span class="hljs-number">1</span> + indexOfPair(tokens, i + <span class="hljs-number">1</span>)
      : i + <span class="hljs-number">2</span>]) != <span class="hljs-literal">null</span> ? ref1$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>);
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span><span class="hljs-params">(token, i)</span>{</span>
    tokens.splice(i, <span class="hljs-number">0</span>, [<span class="hljs-string">'}'</span>, <span class="hljs-string">''</span>, token[<span class="hljs-number">2</span>]]);
  }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">expandLiterals</span><span class="hljs-params">(tokens)</span>{</span>
  <span class="hljs-keyword">var</span> i, fromNum, token, sig, ref$, ref1$, lno, ref2$, ref3$, ref4$, char, toNum, tochar, byNum, byp, ref5$, ts, enc, add, i$, n, ref6$, ref7$, len$, word, that;
  i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (token = tokens[++i]) {
    <span class="hljs-keyword">switch</span> (token[<span class="hljs-number">0</span>]) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'STRNUM'</span>:
      <span class="hljs-keyword">if</span> (~<span class="hljs-string">'-+'</span>.indexOf(sig = token[<span class="hljs-number">1</span>].charAt(<span class="hljs-number">0</span>))) {
        token[<span class="hljs-number">1</span>] = token[<span class="hljs-number">1</span>].slice(<span class="hljs-number">1</span>);
        tokens.splice(i++, <span class="hljs-number">0</span>, [<span class="hljs-string">'+-'</span>, sig, token[<span class="hljs-number">2</span>]]);
      }
      <span class="hljs-keyword">if</span> (token.callable) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'TO'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'TIL'</span>:
      <span class="hljs-keyword">if</span> (!(tokens[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'['</span> &amp;&amp; ((tokens[i + <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">']'</span> &amp;&amp; (((ref$ = tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">1</span>].charAt(<span class="hljs-number">0</span>)) === <span class="hljs-string">'\''</span> || ref$ === <span class="hljs-string">'"'</span>) || +tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &gt;= <span class="hljs-number">0</span>)) || (tokens[i + <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'BY'</span> &amp;&amp; ((ref$ = tokens[i + <span class="hljs-number">3</span>]) != <span class="hljs-literal">null</span> ? ref$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'STRNUM'</span> &amp;&amp; ((ref1$ = tokens[i + <span class="hljs-number">4</span>]) != <span class="hljs-literal">null</span> ? ref1$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">']'</span>)))) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">if</span> (tokens[i + <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'BY'</span>) {
        tokens[i + <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">'RANGE_BY'</span>;
      }
      token.op = token[<span class="hljs-number">1</span>];
      fromNum = <span class="hljs-number">0</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fallthrough</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">case</span> <span class="hljs-string">'RANGE'</span>:
      lno = token[<span class="hljs-number">2</span>];
      <span class="hljs-keyword">if</span> (fromNum != <span class="hljs-literal">null</span> || (tokens[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'['</span> &amp;&amp; tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'STRNUM'</span> &amp;&amp; ((tokens[i + <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">']'</span> &amp;&amp; (((ref2$ = tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">1</span>].charAt(<span class="hljs-number">0</span>)) === <span class="hljs-string">'\''</span> || ref2$ === <span class="hljs-string">'"'</span>) || +tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &gt;= <span class="hljs-number">0</span>)) || (tokens[i + <span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'RANGE_BY'</span> &amp;&amp; ((ref2$ = tokens[i + <span class="hljs-number">3</span>]) != <span class="hljs-literal">null</span> ? ref2$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'STRNUM'</span> &amp;&amp; ((ref3$ = tokens[i + <span class="hljs-number">4</span>]) != <span class="hljs-literal">null</span> ? ref3$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">']'</span>)))) {
        <span class="hljs-keyword">if</span> (fromNum == <span class="hljs-literal">null</span>) {
          ref4$ = decode(token[<span class="hljs-number">1</span>], lno), fromNum = ref4$[<span class="hljs-number">0</span>], char = ref4$[<span class="hljs-number">1</span>];
        }
        ref4$ = decode(tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">1</span>], lno), toNum = ref4$[<span class="hljs-number">0</span>], tochar = ref4$[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">if</span> (toNum == <span class="hljs-literal">null</span> || char ^ tochar) {
          carp(<span class="hljs-string">'bad "to" in range'</span>, lno);
        }
        byNum = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (byp = ((ref4$ = tokens[i + <span class="hljs-number">2</span>]) != <span class="hljs-literal">null</span> ? ref4$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'RANGE_BY'</span>) {
          <span class="hljs-keyword">if</span> (!(byNum = +((ref5$ = tokens[i + <span class="hljs-number">3</span>]) != <span class="hljs-literal">null</span> ? ref5$[<span class="hljs-number">1</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>))) {
            carp(<span class="hljs-string">'bad "by" in range'</span>, tokens[i + <span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
          }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fromNum &gt; toNum) {
          byNum = -<span class="hljs-number">1</span>;
        }
        ts = [];
        enc = char ? character : <span class="hljs-built_in">String</span>;
        add = fn$;
        <span class="hljs-keyword">if</span> (token.op === <span class="hljs-string">'to'</span>) {
          <span class="hljs-keyword">for</span> (i$ = fromNum; byNum &lt; <span class="hljs-number">0</span> ? i$ &gt;= toNum : i$ &lt;= toNum; i$ += byNum) {
            n = i$;
            add();
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">for</span> (i$ = fromNum; byNum &lt; <span class="hljs-number">0</span> ? i$ &gt; toNum : i$ &lt; toNum; i$ += byNum) {
            n = i$;
            add();
          }
        }
        ts.pop() || carp(<span class="hljs-string">'empty range'</span>, lno);
        tokens.splice.apply(tokens, [i, <span class="hljs-number">2</span> + <span class="hljs-number">2</span> * byp].concat(slice$.call(ts)));
        i += ts.length - <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        token[<span class="hljs-number">0</span>] = <span class="hljs-string">'STRNUM'</span>;
        <span class="hljs-keyword">if</span> (((ref6$ = tokens[i + <span class="hljs-number">2</span>]) != <span class="hljs-literal">null</span> ? ref6$[<span class="hljs-number">0</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">8</span>) === <span class="hljs-string">'RANGE_BY'</span>) {
          tokens.splice(i + <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, [<span class="hljs-string">'BY'</span>, <span class="hljs-string">'by'</span>, lno]);
        }
        tokens.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, [<span class="hljs-string">'TO'</span>, token.op, lno]);
      }
      fromNum = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'WORDS'</span>:
      ts = [[<span class="hljs-string">'['</span>, <span class="hljs-string">'['</span>, lno = token[<span class="hljs-number">2</span>]]];
      <span class="hljs-keyword">for</span> (i$ = <span class="hljs-number">0</span>, len$ = (ref7$ = token[<span class="hljs-number">1</span>].match(<span class="hljs-regexp">/\S+/g</span>) || <span class="hljs-string">''</span>).length; i$ &lt; len$; ++i$) {
        word = ref7$[i$];
        ts.push([<span class="hljs-string">'STRNUM'</span>, string(<span class="hljs-string">'\''</span>, word, lno), lno], [<span class="hljs-string">','</span>, <span class="hljs-string">','</span>, lno]);
      }
      tokens.splice.apply(tokens, [i, <span class="hljs-number">1</span>].concat(slice$.call(ts), [[<span class="hljs-string">']'</span>, <span class="hljs-string">']'</span>, lno]]));
      i += ts.length;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'INDENT'</span>:
      <span class="hljs-keyword">if</span> (that = tokens[i - <span class="hljs-number">1</span>]) {
        <span class="hljs-keyword">if</span> (that[<span class="hljs-number">1</span>] === <span class="hljs-string">'new'</span>) {
          tokens.splice(i++, <span class="hljs-number">0</span>, [<span class="hljs-string">'PARAM('</span>, <span class="hljs-string">''</span>, token[<span class="hljs-number">2</span>]], [<span class="hljs-string">')PARAM'</span>, <span class="hljs-string">''</span>, token[<span class="hljs-number">2</span>]], [<span class="hljs-string">'-&gt;'</span>, <span class="hljs-string">''</span>, token[<span class="hljs-number">2</span>]]);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((ref7$ = that[<span class="hljs-number">0</span>]) === <span class="hljs-string">'FUNCTION'</span> || ref7$ === <span class="hljs-string">'GENERATOR'</span> || ref7$ === <span class="hljs-string">'LET'</span>) {
          tokens.splice(i, <span class="hljs-number">0</span>, [<span class="hljs-string">'CALL('</span>, <span class="hljs-string">''</span>, token[<span class="hljs-number">2</span>]], [<span class="hljs-string">')CALL'</span>, <span class="hljs-string">''</span>, token[<span class="hljs-number">2</span>]]);
          i += <span class="hljs-number">2</span>;
        }
      }
      <span class="hljs-keyword">continue</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'LITERAL'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'}'</span>:
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">')'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">')CALL'</span>:
      <span class="hljs-keyword">if</span> (token[<span class="hljs-number">1</span>]) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">']'</span>:
      <span class="hljs-keyword">if</span> (token.index) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CREMENT'</span>:
      <span class="hljs-keyword">if</span> (!able(tokens, i)) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'BIOP'</span>:
      <span class="hljs-keyword">if</span> (!token.spaced &amp;&amp; ((ref7$ = token[<span class="hljs-number">1</span>]) === <span class="hljs-string">'+'</span> || ref7$ === <span class="hljs-string">'-'</span>) &amp;&amp; tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] !== <span class="hljs-string">')'</span>) {
        tokens[i][<span class="hljs-number">0</span>] = <span class="hljs-string">'+-'</span>;
      }
      <span class="hljs-keyword">continue</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">if</span> (token.spaced &amp;&amp; <span class="hljs-keyword">in</span>$(tokens[i + <span class="hljs-number">1</span>][<span class="hljs-number">0</span>], ARG)) {
      tokens.splice(++i, <span class="hljs-number">0</span>, [<span class="hljs-string">','</span>, <span class="hljs-string">','</span>, token[<span class="hljs-number">2</span>]]);
    }
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn$</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0x10000</span> &lt; ts.push([<span class="hljs-string">'STRNUM'</span>, enc(n), lno], [<span class="hljs-string">','</span>, <span class="hljs-string">','</span>, lno])) {
      carp(<span class="hljs-string">'range limit exceeded'</span>, lno);
    }
  }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detectEnd</span><span class="hljs-params">(tokens, i, ok, go)</span>{</span>
  <span class="hljs-keyword">var</span> levels, token, tag;
  levels = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (; token = tokens[i]; ++i) {
    <span class="hljs-keyword">if</span> (!levels &amp;&amp; ok(token, i)) {
      <span class="hljs-keyword">return</span> go(token, i);
    }
    tag = token[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &gt; (levels += <span class="hljs-keyword">in</span>$(tag, OPENERS) || -<span class="hljs-keyword">in</span>$(tag, CLOSERS))) {
      <span class="hljs-keyword">return</span> go(token, i);
    }
  }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indexOfPair</span><span class="hljs-params">(tokens, i)</span>{</span>
  <span class="hljs-keyword">var</span> level, end, start, that;
  level = <span class="hljs-number">1</span>;
  end = INVERSES[start = tokens[i][<span class="hljs-number">0</span>]];
  <span class="hljs-keyword">while</span> (that = tokens[++i]) {
    <span class="hljs-keyword">switch</span> (that[<span class="hljs-number">0</span>]) {
    <span class="hljs-keyword">case</span> start:
      ++level;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> end:
      <span class="hljs-keyword">if</span> (!--level) {
        <span class="hljs-keyword">return</span> i;
      }
    }
  }
  <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
}
KEYWORDS_SHARED = [<span class="hljs-string">'true'</span>, <span class="hljs-string">'false'</span>, <span class="hljs-string">'null'</span>, <span class="hljs-string">'this'</span>, <span class="hljs-string">'void'</span>, <span class="hljs-string">'super'</span>, <span class="hljs-string">'return'</span>, <span class="hljs-string">'throw'</span>, <span class="hljs-string">'break'</span>, <span class="hljs-string">'continue'</span>, <span class="hljs-string">'if'</span>, <span class="hljs-string">'else'</span>, <span class="hljs-string">'for'</span>, <span class="hljs-string">'while'</span>, <span class="hljs-string">'switch'</span>, <span class="hljs-string">'case'</span>, <span class="hljs-string">'default'</span>, <span class="hljs-string">'try'</span>, <span class="hljs-string">'catch'</span>, <span class="hljs-string">'finally'</span>, <span class="hljs-string">'function'</span>, <span class="hljs-string">'class'</span>, <span class="hljs-string">'extends'</span>, <span class="hljs-string">'implements'</span>, <span class="hljs-string">'new'</span>, <span class="hljs-string">'do'</span>, <span class="hljs-string">'delete'</span>, <span class="hljs-string">'typeof'</span>, <span class="hljs-string">'in'</span>, <span class="hljs-string">'instanceof'</span>, <span class="hljs-string">'let'</span>, <span class="hljs-string">'with'</span>, <span class="hljs-string">'var'</span>, <span class="hljs-string">'const'</span>, <span class="hljs-string">'import'</span>, <span class="hljs-string">'export'</span>, <span class="hljs-string">'debugger'</span>, <span class="hljs-string">'yield'</span>];
KEYWORDS_UNUSED = [<span class="hljs-string">'enum'</span>, <span class="hljs-string">'interface'</span>, <span class="hljs-string">'package'</span>, <span class="hljs-string">'private'</span>, <span class="hljs-string">'protected'</span>, <span class="hljs-string">'public'</span>, <span class="hljs-string">'static'</span>];
JS_KEYWORDS = KEYWORDS_SHARED.concat(KEYWORDS_UNUSED);
LS_KEYWORDS = [<span class="hljs-string">'xor'</span>, <span class="hljs-string">'match'</span>, <span class="hljs-string">'where'</span>];
ID = <span class="hljs-regexp">/((?!\s)[a-z_$\xAA-\uFFDC](?:(?!\s)[\w$\xAA-\uFFDC]|-[a-z])*)([^\n\S]*:(?![:=]))?|/ig</span>;
SYMBOL = <span class="hljs-regexp">/[-\/^]=|[%+:*]{1,2}=|\|&gt;=|\.(?:[&amp;\|\^]|&lt;&lt;|&gt;&gt;&gt;?)\.=?|\.{1,3}|\^\^|&lt;(?:--?|~~?)|!?(?:--?|~~?)&gt;\*?|([-+&amp;|:])\1|%%|&amp;|\([^\n\S]*\)|[!=]==?|!?\~=|@@?|&lt;\[(?:[\s\S]*?\]&gt;)?|&lt;&lt;&lt;&lt;?|&lt;\||[&lt;&gt;]==|&lt;&lt;=|&gt;&gt;=|&lt;&lt;|&gt;&gt;|[&lt;&gt;]\??=?|\|&gt;|\||=&gt;|\*\*|\^|`|[^\s#]?/g</span>;
SPACE = <span class="hljs-regexp">/[^\n\S]*(?:#.*)?/g</span>;
MULTIDENT = <span class="hljs-regexp">/(?:\s*#.*)*(?:\n([^\n\S]*))*/g</span>;
SIMPLESTR = <span class="hljs-regexp">/'[^\\']*(?:\\[\s\S][^\\']*)*'|/g</span>;
JSTOKEN = <span class="hljs-regexp">/``[^\\`]*(?:\\[\s\S][^\\`]*)*``|/g</span>;
BSTOKEN = <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'\\\\(?:(\\S[^\\s,;)}\\]]*)|(?:'</span> + SPACE.source + <span class="hljs-string">'\\n?)*)'</span>, <span class="hljs-string">'g'</span>);
NUMBER = <span class="hljs-regexp">/0x[\dA-Fa-f][\dA-Fa-f_]*|(\d*)~([\dA-Za-z]\w*)|((\d[\d_]*)(\.\d[\d_]*)?(?:e[+-]?\d[\d_]*)?)[$\w]*|/g</span>;
NUMBER_OMIT = <span class="hljs-regexp">/_+/g</span>;
REGEX = <span class="hljs-regexp">/\/([^[\/\n\\]*(?:(?:\\.|\[[^\]\n\\]*(?:\\.[^\]\n\\]*)*\])[^[\/\n\\]*)*)\/([gimy]{1,4}|\$?)|/g</span>;
HEREGEX_OMIT = <span class="hljs-regexp">/\s+(?:#.*)?/g</span>;
LASTDENT = <span class="hljs-regexp">/\n[^\n\S]*$/</span>;
INLINEDENT = <span class="hljs-regexp">/[^\n\S]*[^#\s]?/g</span>;
NONASCII = <span class="hljs-regexp">/[\x80-\uFFFF]/</span>;
OPENERS = [<span class="hljs-string">'('</span>, <span class="hljs-string">'['</span>, <span class="hljs-string">'{'</span>, <span class="hljs-string">'CALL('</span>, <span class="hljs-string">'PARAM('</span>, <span class="hljs-string">'INDENT'</span>];
CLOSERS = [<span class="hljs-string">')'</span>, <span class="hljs-string">']'</span>, <span class="hljs-string">'}'</span>, <span class="hljs-string">')CALL'</span>, <span class="hljs-string">')PARAM'</span>, <span class="hljs-string">'DEDENT'</span>];
INVERSES = import$((<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> i$, ref$, len$, resultObj$ = {};
  <span class="hljs-keyword">for</span> (i$ = <span class="hljs-number">0</span>, len$ = (ref$ = OPENERS).length; i$ &lt; len$; ++i$) {
    i = i$;
    o = ref$[i$];
    resultObj$[o] = CLOSERS[i];
  }
  <span class="hljs-keyword">return</span> resultObj$;
}()), (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> i$, ref$, len$, resultObj$ = {};
  <span class="hljs-keyword">for</span> (i$ = <span class="hljs-number">0</span>, len$ = (ref$ = CLOSERS).length; i$ &lt; len$; ++i$) {
    i = i$;
    c = ref$[i$];
    resultObj$[c] = OPENERS[i];
  }
  <span class="hljs-keyword">return</span> resultObj$;
}()));
CHAIN = [<span class="hljs-string">'('</span>, <span class="hljs-string">'{'</span>, <span class="hljs-string">'['</span>, <span class="hljs-string">'ID'</span>, <span class="hljs-string">'STRNUM'</span>, <span class="hljs-string">'LITERAL'</span>, <span class="hljs-string">'LET'</span>, <span class="hljs-string">'WITH'</span>, <span class="hljs-string">'WORDS'</span>];
ARG = CHAIN.concat([<span class="hljs-string">'...'</span>, <span class="hljs-string">'UNARY'</span>, <span class="hljs-string">'CREMENT'</span>, <span class="hljs-string">'PARAM('</span>, <span class="hljs-string">'FUNCTION'</span>, <span class="hljs-string">'GENERATOR'</span>, <span class="hljs-string">'IF'</span>, <span class="hljs-string">'SWITCH'</span>, <span class="hljs-string">'TRY'</span>, <span class="hljs-string">'CLASS'</span>, <span class="hljs-string">'RANGE'</span>, <span class="hljs-string">'LABEL'</span>, <span class="hljs-string">'DECL'</span>, <span class="hljs-string">'DO'</span>, <span class="hljs-string">'BIOPBP'</span>]);
BLOCK_USERS = [<span class="hljs-string">','</span>, <span class="hljs-string">':'</span>, <span class="hljs-string">'-&gt;'</span>, <span class="hljs-string">'ELSE'</span>, <span class="hljs-string">'ASSIGN'</span>, <span class="hljs-string">'IMPORT'</span>, <span class="hljs-string">'UNARY'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">'TRY'</span>, <span class="hljs-string">'FINALLY'</span>, <span class="hljs-string">'HURL'</span>, <span class="hljs-string">'DECL'</span>, <span class="hljs-string">'DO'</span>, <span class="hljs-string">'LET'</span>, <span class="hljs-string">'FUNCTION'</span>, <span class="hljs-string">'GENERATOR'</span>];
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clone$</span><span class="hljs-params">(it)</span>{</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fun</span><span class="hljs-params">()</span>{</span>} fun.prototype = it;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> fun;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">in$</span><span class="hljs-params">(x, xs)</span>{</span>
  <span class="hljs-keyword">var</span> i = -<span class="hljs-number">1</span>, l = xs.length &gt;&gt;&gt; <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (++i &lt; l) <span class="hljs-keyword">if</span> (x === xs[i]) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">import$</span><span class="hljs-params">(obj, src)</span>{</span>
  <span class="hljs-keyword">var</span> own = {}.hasOwnProperty;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> src) <span class="hljs-keyword">if</span> (own.call(src, key)) obj[key] = src[key];
  <span class="hljs-keyword">return</span> obj;
}</div></div></div></div></body></html>